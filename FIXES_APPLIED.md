# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è MercariSearcher - 2025-11-18

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø–æ–∏—Å–∫–∞ –≤ pyMercariAPI/mercari.py

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í —Ñ–∞–π–ª–µ `pyMercariAPI/mercari.py` –º–µ—Ç–æ–¥ `search()` (—Å—Ç—Ä–æ–∫–∏ 111-288) —Å–æ–¥–µ—Ä–∂–∞–ª –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:
- –°—Ç—Ä–æ–∫–∞ 185: –≤—ã–ø–æ–ª–Ω—è–ª—Å—è `asyncio.run(_perform_search())` 
- –°—Ç—Ä–æ–∫–∏ 186-278: –∫–æ–¥ **–ø–æ–≤—Ç–æ—Ä–Ω–æ** —Å–æ–∑–¥–∞–≤–∞–ª event loop –∏ –∑–∞–ø—É—Å–∫–∞–ª —Ç–æ—Ç –∂–µ –ø–æ–∏—Å–∫
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º event loop –∏ –æ—à–∏–±–∫–∞–º –ø–æ–∏—Å–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
–£–¥–∞–ª—ë–Ω –≤–µ—Å—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥. –¢–µ–ø–µ—Ä—å –ø–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ —á–µ—Ä–µ–∑ `asyncio.run()`.

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `pyMercariAPI/mercari.py` (—Å—Ç—Ä–æ–∫–∏ 131-188)

---

### 2. üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø: Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í `simple_telegram_worker.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π `config.TELEGRAM_THREAD_ID` –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ö–∞–∂–¥—ã–π –ø–æ–∏—Å–∫ –≤ –ë–î –∏–º–µ–µ—Ç —Å–≤–æ–π `thread_id`, –Ω–æ –æ–Ω –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
- –í `db.get_unsent_items()` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–ª—Å—è `thread_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `searches`
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —à–ª–∏ –≤ –æ–¥–∏–Ω —Ç–æ–ø–∏–∫ –≤–º–µ—Å—Ç–æ —Ä–∞–∑–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ:**
1. –û–±–Ω–æ–≤–ª—ë–Ω SQL –∑–∞–ø—Ä–æ—Å –≤ `db.get_unsent_items()` - —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `s.thread_id as search_thread_id`
2. –û–±–Ω–æ–≤–ª—ë–Ω `TelegramWorker.send_item_notification()` - –ø–æ–ª—É—á–∞–µ—Ç `thread_id` –∏–∑ item –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–∞–∫ fallback
3. –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `_send_with_photo()` –∏ `_send_message()` - –ø—Ä–∏–Ω–∏–º–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `thread_id`

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `db.py` (—Å—Ç—Ä–æ–∫–∞ 462)
- `simple_telegram_worker.py` (—Å—Ç—Ä–æ–∫–∏ 40-72, 180-240)

---

### 3. ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –ª–æ–≥–∞–º–∏

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
–õ–æ–≥–∏ –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ Web UI –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î –Ω–∞ Railway
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è timezone –≤ –ª–æ–≥–∞—Ö
- Worker –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –∫—Ä–∞—à–∏—Ç—Å—è

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ worker –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω –Ω–∞ Railway
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞–ø—Ä—è–º—É—é: `railway logs`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_fixes.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ Mercari
```bash
python test_fixes.py
```

### 2. –†—É—á–Ω–æ–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞
```bash
python test_mercari_api.py
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ë–î
```bash
python db.py
```

---

## –ö–∞–∫ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway

### –í–∞—Ä–∏–∞–Ω—Ç 1: Git Push (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "Fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –ø–æ–∏—Å–∫–∞ –∏ thread_id –¥–ª—è Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"
git push origin main

# Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Railway CLI
```bash
# –ï—Å–ª–∏ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–æ–µ–∫—Ç–æ–º
railway up

# –ò–ª–∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç—å
railway redeploy
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ worker –∑–∞–ø—É—â–µ–Ω
```bash
railway logs --service worker
```

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏ –≤–∏–¥–∞:
```
[STARTUP] ‚úÖ Active searches: X
[STARTUP] ‚úÖ Startup notification sent to Telegram
[STARTUP] ‚úÖ Scheduler is running
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Web UI –ª–æ–≥–∏
–û—Ç–∫—Ä–æ–π—Ç–µ: https://web-production-fe38.up.railway.app/logs

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–≤–µ–∂–∏–µ –∑–∞–ø–∏—Å–∏ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–æ–π.

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ items –Ω–∞—Ö–æ–¥—è—Ç—Å—è
–ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã:
- –û—Ç–∫—Ä–æ–π—Ç–µ: https://web-production-fe38.up.railway.app/items
- –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ items

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ (–µ—Å–ª–∏ —É searches –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ä–∞–∑–Ω—ã–µ thread_id)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
pyMercariAPI/mercari.py
‚îú‚îÄ –£–¥–∞–ª—ë–Ω –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –ø–æ–∏—Å–∫–∞ (—Å—Ç—Ä–æ–∫–∏ 186-278)
‚îî‚îÄ –£–ø—Ä–æ—â—ë–Ω –º–µ—Ç–æ–¥ search() - —Ç–µ–ø–µ—Ä—å –æ–¥–∏–Ω –≤—ã–∑–æ–≤ asyncio.run()

db.py
‚îî‚îÄ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ search_thread_id –≤ get_unsent_items()

simple_telegram_worker.py
‚îú‚îÄ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä thread_id –≤ send_item_notification()
‚îú‚îÄ –û–±–Ω–æ–≤–ª—ë–Ω _send_with_photo() - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç thread_id
‚îú‚îÄ –û–±–Ω–æ–≤–ª—ë–Ω _send_message() - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç thread_id
‚îî‚îÄ –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç thread_id –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```

---

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

‚úÖ –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ event loop
‚úÖ –õ–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Web UI
‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–æ–ø–∏–∫–∏
‚úÖ Worker –Ω–µ –∫—Ä–∞—à–∏—Ç—Å—è –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ

---

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –≤—Å—ë –µ—â—ë –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `DATABASE_URL` –≤ Railway –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ PostgreSQL –±–∞–∑–∞ –¥–æ—Å—Ç—É–ø–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker: `railway logs --service worker`

### –ü—Ä–æ–±–ª–µ–º–∞: Worker –∫—Ä–∞—à–∏—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
1. –°–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ Railway –ª–æ–≥–∞—Ö
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`
3. –£–≤–µ–ª–∏—á—å—Ç–µ `WORKER_TIMEOUT` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ searches —Ç–∞–±–ª–∏—Ü–µ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏ (`is_active = true`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `scan_interval` –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –∏ `TELEGRAM_CHAT_ID` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- GitHub Issues: https://github.com/2extndd/MRS/issues
- Railway Dashboard: https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
