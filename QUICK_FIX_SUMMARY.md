# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ - –ó–ê–í–ï–†–®–ï–ù–û

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ß–µ—Ä–µ–∑ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è —É –±–æ—Ç–∞ –ª–æ–º–∞–ª—Å—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ—â–µ–π –≤ Telegram.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î** 
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º (`_ensure_connection()`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (`_reconnect()`)
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –∏ exponential backoff –≤ `execute_query()`

### 2. **–ó–∞—â–∏—Ç–∞ —Ü–∏–∫–ª–æ–≤ –æ—Ç —Å–±–æ–µ–≤**
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏) –≤ `search_cycle()` 
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º (3 –ø–æ–ø—ã—Ç–∫–∏) –≤ `telegram_cycle()`
- ‚úÖ Exponential backoff: 5s, 10s, 15s –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- ‚úÖ –¶–∏–∫–ª—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### 3. **–ó–∞—â–∏—Ç–∞ scheduler loop**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `config.reload_if_needed()` - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –∫—ç—à–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ `schedule.run_pending()` - loop –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 4. **Health Check Monitor** 
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ –≤ `wsgi.py`
- ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ scheduler thread –µ—Å–ª–∏ –æ–Ω —É–º–µ—Ä
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ heartbeat (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ 5+ –º–∏–Ω—É—Ç)

### 5. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã `db.add_log_entry()` –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-except
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–æ–ª—å—à–µ –Ω–µ –ª–æ–º–∞—é—Ç —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö retry –ø–æ–ø—ã—Ç–æ–∫

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
‚úÖ PASSED: Database Reconnection
‚úÖ PASSED: Search Cycle Retry
‚úÖ PASSED: Telegram Cycle Retry
‚úÖ PASSED: Config Reload Error Handling
‚úÖ PASSED: Database Execute Query Retry
‚úÖ PASSED: Health Check Monitor
‚úÖ PASSED: Heartbeat Updates

–†–µ–∑—É–ª—å—Ç–∞—Ç: 7/7 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
```

## üöÄ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –∏–∑–º–µ–Ω–∏—Ç—Å—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î ‚Üí –±–æ—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- ‚ùå –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ ‚Üí –≤–µ—Å—å scheduler –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- ‚ùå Gunicorn –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª worker ‚Üí scheduler thread —Ç–µ—Ä—è–µ—Ç—Å—è
- ‚ùå –û—à–∏–±–∫–∞ –≤ config reload ‚Üí scheduler loop –ø–∞–¥–∞–µ—Ç

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ –û—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–º —Ü–∏–∫–ª–µ ‚Üí 3 –ø–æ–ø—ã—Ç–∫–∏ —Å backoff, –ø–æ—Ç–æ–º –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- ‚úÖ Scheduler thread —É–º–µ—Ä ‚Üí health monitor –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –µ–≥–æ —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥
- ‚úÖ –û—à–∏–±–∫–∞ –≤ config reload ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üìù –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏, —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ —É—Å–ø–µ—à–Ω—É—é —Ä–∞–±–æ—Ç—É:
```
[DB] ‚úÖ Reconnected to PostgreSQL          # –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
[SCHEDULER] ‚è∞ Loop alive!                  # Scheduler —Ä–∞–±–æ—Ç–∞–µ—Ç
[SEARCH] Completed at ...                   # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
[TELEGRAM] Sent X/Y notifications           # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
[HEALTH] Health check monitor started       # Health check –∞–∫—Ç–∏–≤–µ–Ω
```

### –õ–æ–≥–∏ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º (–Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ):
```
[DB] Connection check failed: ..., reconnecting...           # –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
[SEARCH] Error (attempt 1/3): ...                            # Retry –∏–¥–µ—Ç
[SEARCH] Retrying in 5 seconds...                            # Backoff —Ä–∞–±–æ—Ç–∞–µ—Ç
[CONFIG] ‚ö†Ô∏è Failed to reload config: ...                     # –ü—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –∫—ç—à–µ–º
[HEALTH] ‚ùå Scheduler thread is DEAD! Restarting...          # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ thread
```

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

### –ù–∞ Railway:
1. –°–¥–µ–ª–∞—Ç—å commit –∏ push –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
3. –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –ø–µ—Ä–≤—ã–µ 10-15 –º–∏–Ω—É—Ç
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–∏–¥–Ω—ã –ª–æ–≥–∏: `[HEALTH] Health check monitor started`

### –õ–æ–∫–∞–ª—å–Ω–æ:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python mercari_notifications.py
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7 –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
- **–°–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤
- **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î –∏ –¥—Ä—É–≥–∏—Ö —Å–±–æ–µ–≤

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ: `FIX_AUTOSTART_ISSUES.md`

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ production
**–î–∞—Ç–∞**: 2024
**–¢–µ—Å—Ç—ã**: 7/7 –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
