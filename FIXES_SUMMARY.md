# MercariSearcher - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (2025-11-17)

### 1. **PostgreSQL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω**
- DATABASE_URL –¥–æ–±–∞–≤–ª–µ–Ω –≤ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ (web –∏ worker)
- Queries –∏ items —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–¥–µ–ø–ª–æ—è
- –ë–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SQLite (—ç—Ñ–µ–º–µ—Ä–Ω–∞—è –ë–î)

### 2. **Config settings —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è**
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ PostgreSQL
- Settings –∏–∑ `/config` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã) —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞

### 3. **Dashboard —É–ª—É—á—à–µ–Ω**
- ‚ùå –£–¥–∞–ª—ë–Ω –±–ª–æ–∫ "Active Queries" (–±—ã–ª –¥—É–±–ª–∏—Ä—É—é—â–∏–º)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ "System Uptime" –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π uptime —Å–µ—Ä–≤–∏—Å–∞
- –¢–µ–ø–µ—Ä—å 4 –∫–∞—Ä—Ç–æ—á–∫–∏: Total Searches, Total Items, API Requests, System Uptime

### 4. **Deadlock –∏—Å–ø—Ä–∞–≤–ª–µ–Ω**
- Worker –±–æ–ª—å—à–µ –Ω–µ –ø–∞–¥–∞–µ—Ç —Å WORKER TIMEOUT
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤ `shared_state.py`

### 5. **PostgreSQL cursor –∏—Å–ø—Ä–∞–≤–ª–µ–Ω**
- HTTP 500 –æ—à–∏–±–∫–∞ "tuple indices must be integers" —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω RealDictCursor –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å PostgreSQL

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–î–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL –Ω–∞ Railway**
–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞ Railway —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–µ –ë–î PostgreSQL:
- `Postgres` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- `Postgres-Fn4V` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)

**–ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω—é—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard: https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å `Postgres-Fn4V`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings —Å–µ—Ä–≤–∏—Å–∞
4. –ù–∞–∂–º–∏—Ç–µ "Delete Service"
5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ

**–í–ê–ñ–ù–û:** –£–¥–∞–ª—è–π—Ç–µ –¢–û–õ–¨–ö–û `Postgres-Fn4V`, –ù–ï —É–¥–∞–ª—è–π—Ç–µ `Postgres` - —ç—Ç–æ —Ä–∞–±–æ—á–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö!

### 2. **Worker –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç queries**
–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ: `[core] Found 0 searches ready for scan`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- Web –∏ Worker –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Ä–∞–∑–Ω—ã–º PostgreSQL –ë–î
- –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ª–∏—à–Ω–µ–π –ë–î –ø—Ä–æ–±–ª–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
- Query –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π `scan_interval`

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω—é—é –ë–î `Postgres-Fn4V` —á–µ—Ä–µ–∑ Railway UI
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ (web –∏ worker)
3. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π query —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ worker - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Found 1 searches ready for scan"

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ **Web —Å–µ—Ä–≤–∏—Å:** –†–ê–ë–û–¢–ê–ï–¢ (https://web-production-fe38.up.railway.app)
- ‚úÖ **PostgreSQL:** –ü–û–î–ö–õ–Æ–ß–ï–ù –∫ –æ–±–æ–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
- ‚úÖ **Config persistence:** –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
- ‚úÖ **Dashboard:** –£–õ–£–ß–®–ï–ù
- ‚ö†Ô∏è **Worker scanning:** –¢—Ä–µ–±—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–µ–π –ë–î

---

## üì¶ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (2025-11-17)

–£–¥–∞–ª–µ–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ POSTGRESQL_SETUP.md (PostgreSQL —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- ‚úÖ GITHUB_PUSH_COMPLETE.txt (—Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å)
- ‚úÖ RAILWAY_NEXT_STEPS.txt (—É—Å—Ç–∞—Ä–µ–ª)
- ‚úÖ RAILWAY_READY.txt (—É—Å—Ç–∞—Ä–µ–ª)
- ‚úÖ deploy_railway.sh (—Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è)
- ‚úÖ run_setup.sh (—Å—Ç–∞—Ä—ã–π setup wrapper)
- ‚úÖ setup_railway.py (—Å—Ç–∞—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π setup)
- ‚úÖ Python cache (__pycache__)

–û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ:
- ‚úÖ README.md (–æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- ‚úÖ FIXES_SUMMARY.md (—Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- ‚úÖ start.sh (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Procfile)
- ‚úÖ requirements.txt (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
- ‚úÖ runtime.txt (–≤–µ—Ä—Å–∏—è Python)

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–¥–µ–ø–ª–æ—è:

1. **–£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω—é—é –ë–î —á–µ—Ä–µ–∑ Railway Dashboard (–í–†–£–ß–ù–£–Æ)**
   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
   - –ù–∞–π–¥–∏—Ç–µ —Å–µ—Ä–≤–∏—Å `Postgres-Fn4V`
   - Settings ‚Üí Delete Service
   - **–í–ê–ñ–ù–û:** Railway CLI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (timeout), –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —á–µ—Ä–µ–∑ UI

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞**
   - –í Railway Dashboard: web ‚Üí Settings ‚Üí Restart
   - –í Railway Dashboard: worker ‚Üí Settings ‚Üí Restart

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
   - –û—Ç–∫—Ä–æ–π—Ç–µ https://web-production-fe38.up.railway.app
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç System Uptime
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ /config –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ª—é–±—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

4. **–î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π query**
   - /queries ‚Üí Add Query
   - –î–æ–±–∞–≤—å—Ç–µ –ª—é–±–æ–π –ø–æ–∏—Å–∫ Mercari
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 –º–∏–Ω—É—Ç
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ /logs - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

---

## üêõ –ö–∞–∫ —Å–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –û—Ç–∫—Ä–æ–π—Ç–µ /logs –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –æ—à–∏–±–∫–∏
3. –û–ø–∏—à–∏—Ç–µ —á—Ç–æ –¥–µ–ª–∞–ª–∏ –¥–æ –æ—à–∏–±–∫–∏
4. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ https://web-production-fe38.up.railway.app/logs?level=ERROR

---

## üìù –ö–æ–º–º–∏—Ç—ã (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

### 2fe911b - Implement config persistence + UI improvements
- Config settings now save to PostgreSQL database
- Dashboard improvements (removed Active Queries, added Uptime)

### ffa686a - Fix PostgreSQL cursor to return dict instead of tuple
- Fixed HTTP 500 error with tuple/dict mismatch

### 7851d15 - Fix critical deadlock in shared_state.py + PostgreSQL config
- Fixed Worker TIMEOUT crashes
- DATABASE_URL configured for both services

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞:** 2025-11-17
**–°—Ç–∞—Ç—É—Å:** –î–µ–ø–ª–æ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞ Railway
