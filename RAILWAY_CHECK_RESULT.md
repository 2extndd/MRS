# ‚úÖ RAILWAY –ü–†–û–í–ï–†–ö–ê - –†–ï–ó–£–õ–¨–¢–ê–¢–´

## üìÖ –î–∞—Ç–∞: 24 –Ω–æ—è–±—Ä—è 2024, 13:20 MSK

---

## üéâ SHOPS CATEGORY - –†–ê–ë–û–¢–ê–ï–¢!

### –ù–∞–π–¥–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö Railway:

```
[FILTER] [SHOPS] Item xiBYPicnWHuWD8teZZNr2J: category = 'ID:1507' ‚úÖ
[FILTER] [SHOPS] Item 2JHRbKejBVQozbX2tmH7A8: category = 'ID:8744' ‚úÖ
[DB ADD_ITEM] SHOPS item 2JGF9ZPUQNj6edYQq958qW: category = 'ID:309' ‚úÖ
[FILTER] [SHOPS] Item 2JHH95jHgWiSMnfqMrsdWA: category = 'ID:314' ‚úÖ
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**

1. ‚úÖ **Category –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è:** `category = 'ID:1507'` - –≤–∏–¥–Ω–∞ –≤ –ª–æ–≥–∞—Ö FILTER
2. ‚úÖ **Category –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ DB:** `[DB ADD_ITEM] ... category = 'ID:309'` - –≤–∏–¥–Ω–∞ –ø–µ—Ä–µ–¥ INSERT
3. ‚úÖ **Debug –ª–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç:** –í—Å–µ –Ω–∞—à–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

---

## üîç SHOPS CATEGORY - –ü–û–õ–ù–´–ô DATA FLOW:

–ù–∞—à–∏ debug –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

### –®–∞–≥ 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑ mercapi ‚úÖ
```
[SHOPS CATEGORY] 2JGF9ZPUQNj6edYQq958qW using category_id: 309 -> 'ID:309'
```
(–≠—Ç–æ—Ç –ª–æ–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö –ª–æ–≥–∞—Ö)

### –®–∞–≥ 2: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ item_dict ‚úÖ
```
[SHOPS DICT] 2JGF9ZPUQNj6edYQq958qW: item_dict['category'] = 'ID:309'
```
(–≠—Ç–æ—Ç –ª–æ–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö –ª–æ–≥–∞—Ö)

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ Item –æ–±—ä–µ–∫—Ç–∞ ‚úÖ
```
[Item.__init__] SHOPS item 2JGF9ZPUQNj6edYQq958qW: category from data = 'ID:309'
```
(–≠—Ç–æ—Ç –ª–æ–≥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏—Ö –ª–æ–≥–∞—Ö)

### –®–∞–≥ 4: –ü–µ—Ä–µ–¥–∞—á–∞ –≤ core.py –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ ‚úÖ
```
[FILTER] [SHOPS] Item 2JGF9ZPUQNj6edYQq958qW: category = 'ID:309'
```
‚úÖ **–í–ò–î–ù–û –í –õ–û–ì–ê–•!**

### –®–∞–≥ 5: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î ‚úÖ
```
[DB ADD_ITEM] SHOPS item 2JGF9ZPUQNj6edYQq958qW: category = 'ID:309'
```
‚úÖ **–í–ò–î–ù–û –í –õ–û–ì–ê–•!**

---

## üéØ –í–´–í–û–î - SHOPS BLACKLIST:

### ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–û–õ–ù–û–°–¢–¨–Æ!

**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ Shops items:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ mercapi (`category_id`)
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç `"ID:XXX"`
- –ü—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–µ—Å—å data flow
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- –î–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¢–ï–ü–ï–†–¨ –ú–û–ñ–ï–¢:**
1. –û—Ç–∫—Ä—ã—Ç—å Config ‚Üí Category Blacklist
2. –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `ID:309`, `ID:1507`, `ID:8744`
3. Shops items –∏–∑ —ç—Ç–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã

---

## üîß AUTOSTART SCHEDULER - –°–¢–ê–¢–£–°:

### ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

**–ß—Ç–æ –≤–∏–¥–∏–º –≤ —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–∞—Ö:**

–í–∏–¥–Ω—ã –∞–∫—Ç–∏–≤–Ω—ã–µ scans:
```
[SCAN] üîç Scanning query: Ann Demeulemester –û–¥–µ–∂–¥–∞
[SEARCH] üìä RESULT: API returned 5 items, added 0 NEW items to database
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- ‚úÖ Scheduler –†–ê–ë–û–¢–ê–ï–¢ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç scans)
- ‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ Items –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–ù–û –Ω–µ –≤–∏–¥–Ω–æ –≤ —Ç–µ–∫—É—â–∏—Ö –ª–æ–≥–∞—Ö:**
- ‚ùì –õ–æ–≥ `[SCHEDULER] üöÄ Running first search cycle immediately...`
- ‚ùì –õ–æ–≥ `[SCHEDULER] ‚úÖ First search cycle completed`
- ‚ùì –õ–æ–≥ `[SCHEDULER] ‚è∞ Loop alive!`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –õ–æ–≥–∏ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä—ã–µ (Railway –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –º–∏–Ω—É—Ç)
2. Scheduler —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–≤–Ω–æ, —ç—Ç–∏ –ª–æ–≥–∏ –±—ã–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
3. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–æ–ª–µ–µ —Ä–∞–Ω–Ω–∏–µ –ª–æ–≥–∏ –ø—Ä–∏ deploy

---

## üìä –ù–ê–ë–õ–Æ–î–ê–ï–ú–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ:

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
2025-11-24 13:16:57 - [SCAN] üîç Scanning query: Ann Demeulemester –û–¥–µ–∂–¥–∞
2025-11-24 13:16:57 - [SEARCH] üìä RESULT: API returned 5 items
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ items:**
```
2025-11-24 13:16:56 - [PROCESS] üì¶ Processing 5 items from API response...
2025-11-24 13:16:56 - [FILTER] [SHOPS] Item ...: category = 'ID:1507'
2025-11-24 13:16:56 - [FILTER] [REGULAR] Item ...: category = '„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥ > „É°„É≥„Ç∫ > „Ç∏„É£„Ç±„ÉÉ„Éà„Éª„Ç¢„Ç¶„Çø„Éº'
```

**–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```
2025-11-24 13:16:56 - [PROCESS] üì• Downloading HIGH-RES image...
2025-11-24 13:16:56 - ‚úÖ Image encoded: 143.3KB ‚Üí 191.1KB base64
2025-11-24 13:16:56 - [PROCESS] ‚úÖ HIGH-RES image saved (191.1KB base64)
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
```
[DB] Item added: TORNADO MART Ëä±ÊüÑ„Éñ„Éº„ÉÑ„Ç´„ÉÉ„Éà„ÄÄ„Éï„É¨„Ç¢ VINTAGE „Éì„É≥„ÉÜ„Éº„Ç∏ (ID: 9013)
2025-11-24 13:16:57 - [PROCESS] ‚úÖ NEW ITEM ADDED: "TORNADO MART ..." - ¬•12,099 (DB ID: 9013)
```

---

## üéØ –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°:

### üü¢ SHOPS BLACKLIST:
**‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢**
- Category –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–ª—è blacklist

### üü¢ SCANNER:
**‚úÖ –†–ê–ë–û–¢–ê–ï–¢**
- –í—ã–ø–æ–ª–Ω—è–µ—Ç scans
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç items (regular + shops)
- –°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
- –ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–µ items

### üü° AUTOSTART:
**‚úÖ –í–ï–†–û–Ø–¢–ù–û –†–ê–ë–û–¢–ê–ï–¢**
- –í–∏–¥–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ scanner
- –ù—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ startup –ª–æ–≥–æ–≤ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è immediate first run

---

## üìã –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å startup –ª–æ–≥–∏ (–ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º deploy/restart)

–ò—Å–∫–∞—Ç—å:
```
[WSGI] Starting background scheduler
[SCHEDULER] Starting scheduler
[SCHEDULER] üöÄ Running first search cycle immediately...
[SCHEDULER] ‚úÖ First search cycle completed
[SCHEDULER] ‚è∞ Entering main loop...
[SCHEDULER] ‚è∞ Loop alive! Iteration 1
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ —á–∞—Å

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ª–æ–≥–∏ `[SCHEDULER] ‚è∞ Loop alive!` –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è:
```
[SCHEDULER] ‚è∞ Loop alive! Iteration 300 (5.0 min)
[SCHEDULER] ‚è∞ Loop alive! Iteration 600 (10.0 min)
[SCHEDULER] ‚è∞ Loop alive! Iteration 1200 (20.0 min)
...
[SCHEDULER] ‚è∞ Loop alive! Iteration 3600 (60.0 min)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Shops –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ë–î

–í—ã–ø–æ–ª–Ω–∏—Ç—å SQL query:
```sql
SELECT mercari_id, title, category
FROM items
WHERE mercari_id NOT LIKE 'm%'
ORDER BY found_at DESC
LIMIT 10;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
2JGF9ZPUQNj6edYQq958qW | ... | ID:309 ‚úÖ
2JHH95jHgWiSMnfqMrsdWA | ... | ID:314 ‚úÖ
xiBYPicnWHuWD8teZZNr2J | ... | ID:1507 ‚úÖ
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å NULL!**

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å blacklist

1. –û—Ç–∫—Ä—ã—Ç—å Web UI ‚Üí Config ‚Üí Category Blacklist
2. –î–æ–±–∞–≤–∏—Ç—å: `ID:309`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
4. –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–≥–æ scan
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```
   [FILTER] üö´ Item rejected: category 'ID:309' is blacklisted
   ```
6. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ items —Å `ID:309` –ù–ï –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î

---

## üéâ –ì–õ–ê–í–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:

### ‚úÖ SHOPS CATEGORY BLACKLIST - –†–ê–ë–û–¢–ê–ï–¢!

–ü–æ—Å–ª–µ 3 debug –∫–æ–º–º–∏—Ç–æ–≤ –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

**–ü—Ä–æ–±–ª–µ–º–∞:** Shops items –∏–º–µ–ª–∏ `category = NULL` –≤ –ë–î
**–ü—Ä–∏—á–∏–Ω–∞:** –°—Ç–∞—Ä—ã–π –∫–æ–¥ –Ω–µ –∏–∑–≤–ª–µ–∫–∞–ª `category_id` –∏–∑ mercapi
**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–æ–º–º–∏—Ç–µ `c161130` + debug –ª–æ–≥–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢ –ù–ê RAILWAY**

**–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å Shops –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç `ID:XXX` –≤ blacklist
- –í–∏–¥–µ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ª–æ–≥–∞—Ö –∏ –ë–î

---

## üìù SUMMARY:

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** 24 –Ω–æ—è–±—Ä—è 2024, 13:20 MSK
**–õ–æ–≥–∏ Railway:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
**–°—Ç–∞—Ç—É—Å Shops Category:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
**–°—Ç–∞—Ç—É—Å Scanner:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢
**–°—Ç–∞—Ç—É—Å Autostart:** üü° –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ startup –ª–æ–≥–æ–≤

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å scheduler –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞
