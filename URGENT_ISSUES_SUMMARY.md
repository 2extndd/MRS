# ÔøΩÔøΩ–°–†–û–ß–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø - MercariSearcher

**–î–∞—Ç–∞:** 2025-11-17
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è

### –°–∏–º–ø—Ç–æ–º—ã:
```json
{
    "queries": [],
    "success": true
}
```

- Web API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 queries
- Worker logs: "Found 0 searches ready for scan"
- Total items: 0
- Active searches: 0

### –ü—Ä–∏—á–∏–Ω–∞:
**–í–û–ó–ú–û–ñ–ù–û –£–î–ê–õ–ï–ù–ê –ù–ï –¢–ê –ë–ê–ó–ê –î–ê–ù–ù–´–•!**

–ë—ã–ª–æ 2 –±–∞–∑—ã:
- `Postgres` (postgres.railway.internal)
- `Postgres-Fn4V` (postgres-fn4v.railway.internal)

–°–µ–π—á–∞—Å —Å–µ—Ä–≤–∏—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –ë–î –≥–¥–µ **–ù–ï–¢ queries**!

### ‚ö†Ô∏è –í–ê–ñ–ù–û:
**–ù–ï –£–î–ê–õ–Ø–ô–¢–ï Postgres-Fn4V –î–û –ü–†–û–í–ï–†–ö–ò!** –¢–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ!

### –†–µ—à–µ–Ω–∏–µ:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard: https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫–∏–µ –ë–î PostgreSQL —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. –ï—Å–ª–∏ Postgres-Fn4V –µ—â–µ –∂–∏–≤–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ —Ç–∞–º queries
4. –ï—Å–ª–∏ –¥–∞ - –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ web –∏ worker –∫ Postgres-Fn4V
5. –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤—å—Ç–µ queries –∑–∞–Ω–æ–≤–æ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

---

## ‚úÖ –•–û–†–û–®–ò–ï –ù–û–í–û–°–¢–ò: Mercari API —Ä–∞–±–æ—Ç–∞–µ—Ç!

### –¢–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ:
```bash
$ python3 test_mercari_api.py
‚úÖ TEST PASSED
üì¶ Found 10 items

--- ITEM #1 ---
ID:        m60729517663
Name:      Y-3 QASA BOOT
Price:     ¬•9,000
Condition: ÂÇ∑„ÇÑÊ±ö„Çå„ÅÇ„Çä
```

**–ü–æ–∏—Å–∫ Y-3 —Ç–æ–≤–∞—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ —á–µ—Ä–µ–∑ mercapi library!**

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê #2: Config —Ç—Ä–µ–±—É–µ—Ç restart —Å–µ—Ä–≤–∏—Å–∞

### –°–∏–º–ø—Ç–æ–º—ã:
- Config —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î ‚úÖ
- –ù–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Restart required" ‚ùå
- –í KufarSearcher —Ç–∞–∫–æ–≥–æ –Ω–µ –±—ã–ª–æ

### –ü—Ä–∏—á–∏–Ω–∞:
Config —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ PostgreSQL, –Ω–æ:
1. Worker –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ ENV variables
2. Worker –ù–ï —á–∏—Ç–∞–µ—Ç config –∏–∑ –ë–î –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
3. –ü–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ restart

### –†–µ—à–µ–Ω–∏–µ (–Ω—É–∂–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å):

**–í–∞—Ä–∏–∞–Ω—Ç 1: Hot reload config**
```python
# –í core.py - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ reload_config()
def reload_config(self):
    """Reload configuration from database"""
    config = self.db.get_all_config()
    self.scan_interval = config.get('scan_interval', 300)
    # ... update other settings
    logger.info("Config reloaded from database")
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: Config —á–µ—Ä–µ–∑ ENV** (–∫–∞–∫ –≤ KufarSearcher)
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å config –Ω–µ –≤ –ë–î, –∞ –æ–±–Ω–æ–≤–ª—è—Ç—å ENV —á–µ—Ä–µ–∑ Railway API
- –¢–æ–≥–¥–∞ –ø—Ä–∏ restart —Å–µ—Ä–≤–∏—Å–∞ config –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—Å—è

---

## üìã –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:

‚úÖ Web —Å–µ—Ä–≤–∏—Å: https://web-production-fe38.up.railway.app
‚úÖ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –æ–±–æ–∏–º —Å–µ—Ä–≤–∏—Å–∞–º
‚úÖ Mercari API (mercapi) –Ω–∞—Ö–æ–¥–∏—Ç —Ç–æ–≤–∞—Ä—ã
‚úÖ Config —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Dashboard –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç System Uptime
‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑ FIXES_SUMMARY.md –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

---

## üìã –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢:

‚ùå Queries –≤ –ë–î = 0 (–±–∞–∑–∞ –ø—É—Å—Ç–∞—è!)
‚ùå Worker –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç searches (–ø–æ—Ç–æ–º—É —á—Ç–æ queries = 0)
‚ùå Config changes —Ç—Ä–µ–±—É—é—Ç restart
‚ùå MercariScraper (HTML –ø–∞—Ä—Å–µ—Ä) –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - Mercari –∏–∑–º–µ–Ω–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É

---

## üîß –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–°–†–û–ß–ù–û!)
```bash
# –í Railway Dashboard
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
3. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ PostgreSQL —Å–µ—Ä–≤–∏—Å—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫ –∫–∞–∫–æ–π –ë–î –ø–æ–¥–∫–ª—é—á–µ–Ω—ã web –∏ worker:
   - Variables ‚Üí DATABASE_URL
```

### 2. –î–æ–±–∞–≤–∏—Ç—å query –≤—Ä—É—á–Ω—É—é
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://web-production-fe38.up.railway.app/queries
2. Add Query:
   Name: Y-3 Test
   URL: https://jp.mercari.com/search?keyword=Y-3
   Chat ID: -4997297083
   Active: ‚úì
   Scan Interval: 300
3. Save
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å worker logs
```bash
# –ß–µ—Ä–µ–∑ Railway Dashboard –∏–ª–∏ CLI
railway service worker && railway logs

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
"[core] Found 1 searches ready for scan"
```

### 4. –ï—Å–ª–∏ queries –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è:
- –ó–Ω–∞—á–∏—Ç worker –∏ web –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –†–ê–ó–ù–´–ú –ë–î
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ –æ–¥–Ω–æ–π –ë–î
- –ò–ª–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫ Postgres-Fn4V –≥–¥–µ –¥–∞–Ω–Ω—ã–µ

---

## üêõ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–•–û–î–ö–ò:

### MercariScraper –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
```python
# mercari_scraper.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTML –ø–∞—Ä—Å–∏–Ω–≥
# –ò—â–µ—Ç: window.__INITIAL_STATE__
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "Could not find __INITIAL_STATE__ in page"
```

**–ü—Ä–∏—á–∏–Ω–∞:** Mercari –∏–∑–º–µ–Ω–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pyMercariAPI.Mercari` –≤–º–µ—Å—Ç–æ `MercariScraper`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `mercapi>=0.4.2`
- –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API
- –¢–µ—Å—Ç –ø–æ–∫–∞–∑–∞–ª: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢!

---

## üìù –¢–ï–°–¢–û–í–´–ï –§–ê–ô–õ–´ –°–û–ó–î–ê–ù–´:

1. **test_mercari_api.py** - –¢–µ—Å—Ç Mercari API —á–µ—Ä–µ–∑ pyMercariAPI ‚úÖ PASSED
2. **test_mercari_search.py** - –¢–µ—Å—Ç HTML –ø–∞—Ä—Å–µ—Ä–∞ ‚ùå FAILED (—É—Å—Ç–∞—Ä–µ–ª)

---

## üîç –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ß–¢–û –í–°–ï –†–ê–ë–û–¢–ê–ï–¢:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ queries –µ—Å—Ç—å
curl https://web-production-fe38.up.railway.app/api/queries | python3 -m json.tool

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# {"queries": [{"name": "Y-3 Test", ...}], "success": true}

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å worker logs
railway service worker && railway logs | grep "Found.*searches"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "[core] Found 1 searches ready for scan"

# 3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å items
curl https://web-production-fe38.up.railway.app/api/stats | python3 -m json.tool

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# {"database": {"total_items": 10, ...}}
```

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–´:

1. **–ö–†–ò–¢–ò–ß–ù–û:** –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å queries –≤ –ë–î
2. **–í–´–°–û–ö–ò–ô:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ web –∏ worker –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ë–î
3. **–°–†–ï–î–ù–ò–ô:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å "restart required" –¥–ª—è config
4. **–ù–ò–ó–ö–ò–ô:** –£–¥–∞–ª–∏—Ç—å HTML –ø–∞—Ä—Å–µ—Ä (MercariScraper) - –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-17 14:20 UTC
