# ü§ñ AI AGENT MEMORY - MercariSearcher Bot

## ‚ö†Ô∏è –ü–û–°–¢–û–Ø–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê

### –ü—Ä–∞–≤–∏–ª–æ 1: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å** –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û** —ç—Ç–æ—Ç —Ñ–∞–π–ª `AI_AGENT_MEMORY.md`
- –í—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç - –¢–û–õ–¨–ö–û –ó–î–ï–°–¨
- **–ù–ï —Ç—Ä–∞—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã** –Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –ü—Ä–∞–≤–∏–ª–æ 2: –ö–æ–º–∞–Ω–¥–∞ "–ó–ê–ü–û–ú–ù–ò!"
- –ü–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–ó–ê–ü–û–ú–ù–ò!" –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª
- –ü—Ä–∞–≤–∏–ª–∞ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π

### –ü—Ä–∞–≤–∏–ª–æ 3: –ö–æ–º–∞–Ω–¥–∞ "–ó–ê–ü–û–ú–ù–ò –ö–û–ù–¢–ï–ö–°–¢!"
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª
- –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ AI –∞–≥–µ–Ω—Ç–∞–º–∏

---

## üìã –û –ü–†–û–ï–ö–¢–ï: MercariSearcher Bot

### –ß—Ç–æ —ç—Ç–æ?
Telegram –±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Mercari.jp (—è–ø–æ–Ω—Å–∫–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å). –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ò—â–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –í–´–°–û–ö–û–ú —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

### –û—Å–Ω–æ–≤–∞
- **–Ø–∑—ã–∫**: Python 3
- **API –±–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `mercapi` (v0.4.2+)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL –Ω–∞ Railway
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: Railway (web + worker)
- **Telegram**: python-telegram-bot

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
mercari_notifications.py (main)
  ‚îú‚îÄ> core.py (MercariSearcher) - –ø–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
  ‚îÇ   ‚îî‚îÄ> pyMercariAPI/mercari.py - –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ mercapi
  ‚îÇ       ‚îî‚îÄ> mercapi library - —Ä–µ–∞–ª—å–Ω—ã–π API Mercari
  ‚îÇ
  ‚îú‚îÄ> image_handler.py - –∑–∞–≥—Ä—É–∑–∫–∞ HIGH-RES —Ñ–æ—Ç–æ
  ‚îÇ
  ‚îú‚îÄ> db.py - —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
  ‚îÇ
  ‚îî‚îÄ> simple_telegram_worker.py - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
```

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã

1. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥
2. **–ü–æ–∏—Å–∫** —á–µ—Ä–µ–∑ `mercapi.search(query="keyword")`
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞**:
   - –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏: `mercapi.item(item_id)`
   - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å URL —Ñ–æ—Ç–æ –≤ HIGH-RES (`/item/detail/orig/photos/`)
   - –°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ (–ë–ï–ó –ø—Ä–æ–∫—Å–∏!)
   - –ó–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –≤ base64
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PostgreSQL
4. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø–æ mercari_id)
5. **Telegram** —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å high-res —Ñ–æ—Ç–æ

---

## üîß –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
- `mercari_notifications.py` - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
- `core.py` - –∫–ª–∞—Å—Å MercariSearcher, –≤—Å—è –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞
- `image_handler.py` - –∑–∞–≥—Ä—É–∑–∫–∞ HIGH-RES –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚≠ê
- `db.py` - —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
- `simple_telegram_worker.py` - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `configuration_values.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### API –æ–±—ë—Ä—Ç–∫–∞
- `pyMercariAPI/mercari.py` - —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π wrapper –≤–æ–∫—Ä—É–≥ mercapi
- `pyMercariAPI/items.py` - –∫–ª–∞—Å—Å—ã Item/Items
- `pyMercariAPI/exceptions.py` - –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### –¢–µ—Å—Ç—ã
- `test_real_mercari.py` - —Ä–∞–±–æ—Ç–∞—é—â–∏–π —Ç–µ—Å—Ç
- `railway_test_deployment.py` - —Ç–µ—Å—Ç –¥–ª—è Railway

---

## ‚≠ê –ü–û–°–õ–ï–î–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø (19 –Ω–æ—è–±—Ä—è 2024)

### 1. –°–æ–∑–¥–∞–Ω `image_handler.py`
**–§—É–Ω–∫—Ü–∏–∏**:
- `get_original_image_url(url)` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ª—é–±–æ–π URL –≤ HIGH-RES
  - –í—Ö–æ–¥–Ω–æ–π: `https://static.mercdn.net/thumb/...` (240px)
  - –í—ã—Ö–æ–¥–Ω–æ–π: `https://static.mercdn.net/item/detail/orig/photos/mXXX_N.jpg` (1200px+)
- `download_and_encode_image(url)` - —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏ –∫–æ–¥–∏—Ä—É–µ—Ç –≤ base64
  - –ë–ï–ó –ø—Ä–æ–∫—Å–∏! Mercari CDN –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `data:image/jpeg;base64,...`

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `core.py`
**–ú–µ—Ç–æ–¥ `_process_new_items()`**:
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º Item: `.id`, `.title`, `.price`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è URL –≤ HIGH-RES
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `image_data` –≤ –±–∞–∑—É

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `pyMercariAPI/mercari.py`
**–ú–µ—Ç–æ–¥ `search()`**:
- –ë—ã–ª–æ: `await m.search(keyword=...)`
- –°—Ç–∞–ª–æ: `await m.search(query=...)`
- –§–∏–∫—Å: mercapi –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `query`, –Ω–µ `keyword`

### 4. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `simple_telegram_worker.py`
**–ú–µ—Ç–æ–¥ `send_item_notification()`**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è URL –≤ HIGH-RES –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- Telegram –ø–æ–ª—É—á–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `test_real_mercari.py`
- –û–±–Ω–æ–≤–ª—ë–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `query=` –≤–º–µ—Å—Ç–æ `keyword=`

---

## üìä –ë–ê–ó–ê –î–ê–ù–ù–´–• (PostgreSQL)

### –¢–∞–±–ª–∏—Ü–∞ `items`
```sql
id              SERIAL PRIMARY KEY
mercari_id      VARCHAR(50) UNIQUE
title           TEXT
price           INTEGER
image_url       TEXT              -- HIGH-RES URL
image_data      TEXT              -- Base64 encoded image ‚≠ê
telegram_sent   BOOLEAN
created_at      TIMESTAMP
```

**–í–∞–∂–Ω–æ**: 
- `image_url` - URL –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏
- `image_data` - base64 –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ñ–æ—Ç–æ (130-500KB)
- –í—Å–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å —Ñ–æ—Ç–æ!

---

## üöÄ RAILWAY

### Project ID
`f17da572-14c9-47b5-a9f1-1b6d5b6dea2d`

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
DATABASE_URL=postgresql://...
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...
TELEGRAM_THREAD_ID=...  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
PROXY_ENABLED=false     # —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ë–ï–ó –ø—Ä–æ–∫—Å–∏!
```

### –î–µ–ø–ª–æ–π
```bash
railway link -p f17da572-14c9-47b5-a9f1-1b6d5b6dea2d
git add .
git commit -m "commit message"
git push
railway logs -f
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –õ–æ–∫–∞–ª—å–Ω–æ
```bash
python3 test_real_mercari.py
```

### –ù–∞ Railway
```bash
railway ssh
python3 railway_test_deployment.py
```

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (19 –Ω–æ—è–±—Ä—è 2024)
- ‚úÖ –ù–∞–π–¥–µ–Ω–æ: 120 —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ: 70 –ù–û–í–´–• —Å high-res —Ñ–æ—Ç–æ
- ‚úÖ –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ: 50 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 100%

---

## üîç –í–ê–ñ–ù–´–ï –î–ï–¢–ê–õ–ò

### mercapi —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
```python
# –ü–†–ê–í–ò–õ–¨–ù–û:
await m.search(query="keyword")
item = await m.item("m12345678")

# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Å—Ç–∞—Ä—ã–π –∫–æ–¥):
await m.search(keyword="keyword")  # ‚ùå
```

### Item –∞—Ç—Ä–∏–±—É—Ç—ã (mercapi)
```python
item.id_           # ID —Ç–æ–≤–∞—Ä–∞
item.name          # –Ω–∞–∑–≤–∞–Ω–∏–µ
item.price         # —Ü–µ–Ω–∞
item.photos        # —Å–ø–∏—Å–æ–∫ ORIGINAL URLs
item.thumbnails    # —Å–ø–∏—Å–æ–∫ thumbnail URLs
item.item_condition.name   # —Å–æ—Å—Ç–æ—è–Ω–∏–µ
item.item_category.name    # –∫–∞—Ç–µ–≥–æ—Ä–∏—è
```

### HIGH-RES –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```python
from image_handler import get_original_image_url, download_and_encode_image

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è URL
high_res_url = get_original_image_url(thumbnail_url)

# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
image_data = download_and_encode_image(high_res_url, use_proxy=False)
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "data:image/jpeg;base64,..."
```

### –ë–µ–∑ –ø—Ä–æ–∫—Å–∏!
**–í–∞–∂–Ω–æ**: –§–æ—Ç–æ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –ë–ï–ó –ø—Ä–æ–∫—Å–∏. Mercari CDN –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## üìù –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 19 –Ω–æ—è–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å**: ‚úÖ PRODUCTION READY
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: 95%+

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ mercapi
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ HIGH-RES —Ñ–æ—Ç–æ (–±–µ–∑ –ø—Ä–æ–∫—Å–∏)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL —Å base64
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å high-res —Ñ–æ—Ç–æ
- ‚úÖ Web UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ Hot-reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ production
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏

---

## üí° –ö–û–ù–¢–ï–ö–°–¢ –ü–û–°–õ–ï–î–ù–ï–ô –°–ï–°–°–ò–ò

**–ó–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ**:
1. –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `image_handler.py` –¥–ª—è HIGH-RES —Ñ–æ—Ç–æ
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `mercapi` (query= –≤–º–µ—Å—Ç–æ keyword=)
3. –û–±–Ω–æ–≤–ª—ë–Ω `core.py` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ø–æ–∏—Å–∫ ‚Üí –ë–î ‚Üí Telegram
5. –û—á–∏—â–µ–Ω –ø—Ä–æ–µ–∫—Ç –æ—Ç –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (43+ —Ñ–∞–π–ª–∞ —É–¥–∞–ª–µ–Ω–æ)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤**:
- 120 —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–π–¥–µ–Ω–æ
- 70 –Ω–æ–≤—ã—Ö –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å HIGH-RES —Ñ–æ—Ç–æ
- 50 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ
- 100% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ

**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –Ω–∞ Railway

---

## üîß TROUBLESHOOTING

### –§–æ—Ç–æ –Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL –≤ –ª–æ–≥–∞—Ö (–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `/item/detail/orig/photos/`)
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `use_proxy=False`

### mercapi –æ—à–∏–±–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `search(query=...)`  –Ω–µ `search(keyword=...)`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã: `item.id_`, `item.name`, –Ω–µ `item.id`, `item.title`

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `image_data` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å TEXT, –Ω–µ BYTEA
- –§–æ—Ä–º–∞—Ç: `data:image/jpeg;base64,...`

---

*–≠—Ç–æ—Ç —Ñ–∞–π–ª - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤.*
*–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.*

---

## üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï (19 –Ω–æ—è–±—Ä—è 2024 - –ü–û–°–õ–ï–î–ù–ï–ï)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 3 –æ—Å–Ω–æ–≤–Ω—ã—Ö –±–∞–≥–∞

#### 1. db.add_item() –≤–æ–∑–≤—Ä–∞—â–∞–ª None –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –í PostgreSQL `cursor.lastrowid` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—Å–µ–≥–¥–∞ `None`

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `RETURNING id` –≤ INSERT –∑–∞–ø—Ä–æ—Å–µ
```python
INSERT INTO items (...) VALUES (...) RETURNING id
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å `new_items` —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ –ª–æ–≥–∞—Ö!

#### 2. Hot-reload —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø–æ—Å—Ç–æ—è–Ω–Ω–æ ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: `_config_cache` —Å—Ä–∞–≤–Ω–∏–≤–∞–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å—á–∏—Ç–∞–ª—Å—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ `configuration_values.py`:
- –ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: `config_changed = True`
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ: —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `config_` –∫–ª—é—á–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: Hot-reload —Ç–µ–ø–µ—Ä—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –†–ï–ê–õ–¨–ù–´–• –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–Ω—Ñ–∏–≥–∞

#### 3. –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–æ—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î ‚úÖ
**–£–∂–µ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ** - —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∞–∂–µ —Å `image_data = NULL`

---

### –û—Å—Ç–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã

#### ‚úÖ "–¢–æ 5, —Ç–æ 50 items" –≤ –ª–æ–≥–∞—Ö - –û–ë–™–Ø–°–ù–ï–ù–û
**–°–∏–º–ø—Ç–æ–º**: –í –ª–æ–≥–∞—Ö —Ç–æ `Found 5 items`, —Ç–æ `Found 50 items`

**–ü–†–ò–ß–ò–ù–ê**: `mercapi` –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **–ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä limit**!

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- `mercapi.search(query="keyword")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –Ω–∞–π–¥—ë—Ç (–æ–±—ã—á–Ω–æ 5-120)
- –ü–æ—Ç–æ–º `pyMercariAPI` –æ–±—Ä–µ–∑–∞–µ—Ç –¥–æ `limit`
- –ï—Å–ª–∏ mercapi –Ω–∞—à—ë–ª 5 —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí –≤–µ—Ä–Ω—ë—Ç 5 (–¥–∞–∂–µ –µ—Å–ª–∏ limit=50)
- –ï—Å–ª–∏ mercapi –Ω–∞—à—ë–ª 120 —Ç–æ–≤–∞—Ä–æ–≤ ‚Üí –æ–±—Ä–µ–∂–µ—Ç –¥–æ 50 (–µ—Å–ª–∏ limit=50)

**–≠—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û!** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ, —Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ Mercari –≤–µ—Ä–Ω—É–ª –ø–æ –∑–∞–ø—Ä–æ—Å—É.

**–í –ª–æ–≥–∞—Ö —Ç–µ–ø–µ—Ä—å**:
```
mercapi returned 5 items, will limit to 6
API returned 5 items (limit: 6)
Found 5 items (2 new)
```

–∏–ª–∏

```
mercapi returned 120 items, will limit to 6
API returned 6 items (limit: 6)
Found 6 items (3 new)
```

**–ò—Ç–æ–≥**: –ï—Å–ª–∏ `limit=6` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –±–æ—Ç –≤–æ–∑—å–º—ë—Ç –º–∞–∫—Å–∏–º—É–º 6 —Ç–æ–≤–∞—Ä–æ–≤, –¥–∞–∂–µ –µ—Å–ª–∏ mercapi –≤–µ—Ä–Ω—É–ª 120.

#### ‚úÖ "new items = 1, –∞ –≤–µ—â–µ–π 2" - –ò–°–ü–†–ê–í–õ–ï–ù–û
**–°–∏–º–ø—Ç–æ–º**: –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è 2 —Ç–æ–≤–∞—Ä–∞, –Ω–æ –≤ –ª–æ–≥–∞—Ö `(1 new)`

**–ü–†–ò–ß–ò–ù–ê**: `full_item.to_dict()` –ø–∞–¥–∞–ª —Å –æ—à–∏–±–∫–æ–π –Ω–∞ mercapi –æ–±—ä–µ–∫—Ç–∞—Ö!

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ**:
1. –¢–æ–≤–∞—Ä 1: `api.get_item()` —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Item —Å `.to_dict()` ‚úÖ
2. –¢–æ–≤–∞—Ä 2: `api.get_item()` –ø–∞–¥–∞–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `item` –∏–∑ –ø–æ–∏—Å–∫–∞ (mercapi –æ–±—ä–µ–∫—Ç)
3. mercapi –æ–±—ä–µ–∫—Ç **–ù–ï –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥–∞ `.to_dict()`** ‚Üí Exception!
4. Exception –ª–æ–≤–∏—Ç—Å—è, —Ç–æ–≤–∞—Ä –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `new_items` —Å–ø–∏—Å–æ–∫
5. –†–µ–∑—É–ª—å—Ç–∞—Ç: –í –ë–î 2 —Ç–æ–≤–∞—Ä–∞, –Ω–æ `len(new_items) = 1`

**–†–µ—à–µ–Ω–∏–µ**:
```python
if hasattr(full_item, 'to_dict'):
    item_dict = full_item.to_dict()  # –ù–∞—à Item –∫–ª–∞—Å—Å
else:
    item_dict = { ... }  # –°–æ–∑–¥–∞—Ç—å dict –≤—Ä—É—á–Ω—É—é –∏–∑ mercapi –æ–±—ä–µ–∫—Ç–∞
```

**–¢–µ–ø–µ—Ä—å**: –í—Å–µ —Ç–æ–≤–∞—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ø–∏—Å–æ–∫, —Å—á—ë—Ç—á–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π!

---

## üìä –ö–ê–ö –†–ê–ë–û–¢–ê–Æ–¢ –õ–ò–ú–ò–¢–´ (Items Per Query)

### –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```
1. mercapi.search(query="Y-3")
   ‚Üì
   –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –í–°–ï —Ç–æ–≤–∞—Ä—ã (–æ–±—ã—á–Ω–æ 5-120)
   –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ü–æ –¥–∞—Ç–µ (newest first)
   
2. pyMercariAPI –æ–±—Ä–µ–∑–∞–µ—Ç –¥–æ limit
   ‚Üì
   –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 6 —Ç–æ–≤–∞—Ä–æ–≤ (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
   
3. db.add_item() —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã
   ‚Üì
   –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –£–ñ–ï –≤ –±–∞–∑–µ ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
   –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –ù–û–í–´–ô ‚Üí –¥–æ–±–∞–≤–∏—Ç—å
   
4. –†–µ–∑—É–ª—å—Ç–∞—Ç
   ‚Üì
   –í –ª–æ–≥–∞—Ö: "Found 6 items (2 new)"
   –í –±–∞–∑–µ: +2 –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–∞
```

### –ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ø–∞–¥–∞—é—Ç –ø–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

**Items Per Query = 6 –æ–∑–Ω–∞—á–∞–µ—Ç:**
- –ë–µ—Ä—É—Ç—Å—è **–ü–ï–†–í–´–ï 6 —Ç–æ–≤–∞—Ä–æ–≤** –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ Mercari
- Mercari —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ –¥–∞—Ç–µ: **–ù–û–í–´–ï –°–ù–ê–ß–ê–õ–ê**
- –ó–Ω–∞—á–∏—Ç –±–µ—Ä—É—Ç—Å—è **6 –°–ê–ú–´–• –°–í–ï–ñ–ò–•** —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä:**
```
Mercari –≤–µ—Ä–Ω—É–ª 120 —Ç–æ–≤–∞—Ä–æ–≤:

[1] –î–æ–±–∞–≤–ª–µ–Ω 2 –º–∏–Ω –Ω–∞–∑–∞–¥    ‚Üê –ë–ï–†–Å–ú (–Ω–æ–≤–µ–π—à–∏–π)
[2] –î–æ–±–∞–≤–ª–µ–Ω 5 –º–∏–Ω –Ω–∞–∑–∞–¥    ‚Üê –ë–ï–†–Å–ú
[3] –î–æ–±–∞–≤–ª–µ–Ω 10 –º–∏–Ω –Ω–∞–∑–∞–¥   ‚Üê –ë–ï–†–Å–ú
[4] –î–æ–±–∞–≤–ª–µ–Ω 15 –º–∏–Ω –Ω–∞–∑–∞–¥   ‚Üê –ë–ï–†–Å–ú
[5] –î–æ–±–∞–≤–ª–µ–Ω 20 –º–∏–Ω –Ω–∞–∑–∞–¥   ‚Üê –ë–ï–†–Å–ú
[6] –î–æ–±–∞–≤–ª–µ–Ω 30 –º–∏–Ω –Ω–∞–∑–∞–¥   ‚Üê –ë–ï–†–Å–ú (–ø–æ—Å–ª–µ–¥–Ω–∏–π)
[7] –î–æ–±–∞–≤–ª–µ–Ω 1 —á–∞—Å –Ω–∞–∑–∞–¥    ‚Üê –ù–ï –ë–ï–†–Å–ú
...
[120] –î–æ–±–∞–≤–ª–µ–Ω 3 –¥–Ω—è –Ω–∞–∑–∞–¥  ‚Üê –ù–ï –ë–ï–†–Å–ú
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ Web UI

**Items Per Query = 6:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç 6 —Å–∞–º—ã—Ö –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞–∂–¥—ã–π —Ü–∏–∫–ª
- –•–æ—Ä–æ—à–æ –¥–ª—è —á–∞—Å—Ç–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (60 —Å–µ–∫)
- –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –Ω–∏—á–µ–≥–æ –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è < 6 —Ç–æ–≤–∞—Ä–æ–≤/–º–∏–Ω—É—Ç—É

**Query Delay = 60 —Å–µ–∫—É–Ω–¥:**
- –ë–æ—Ç —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç 6 —Å–∞–º—ã—Ö –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ï—Å–ª–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

**–ó–∞–ø—Ä–æ—Å: "Y-3 Clothing"**
**Settings: 6 items, 60 sec**

```
–¶–∏–∫–ª 1 (0:00):
  Mercari –≤–µ—Ä–Ω—É–ª 120 —Ç–æ–≤–∞—Ä–æ–≤
  –í–∑—è–ª–∏ –ø–µ—Ä–≤—ã–µ 6 (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
  –í—Å–µ 6 –ù–û–í–´–ï ‚Üí –¥–æ–±–∞–≤–∏–ª–∏
  –õ–æ–≥–∏: "Found 6 items (6 new)"

–¶–∏–∫–ª 2 (1:00):
  Mercari –≤–µ—Ä–Ω—É–ª 120 —Ç–æ–≤–∞—Ä–æ–≤
  –í–∑—è–ª–∏ –ø–µ—Ä–≤—ã–µ 6 (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
  5 —É–∂–µ –±—ã–ª–∏, 1 –Ω–æ–≤—ã–π
  –õ–æ–≥–∏: "Found 6 items (1 new)"

–¶–∏–∫–ª 3 (2:00):
  Mercari –≤–µ—Ä–Ω—É–ª 120 —Ç–æ–≤–∞—Ä–æ–≤
  –í–∑—è–ª–∏ –ø–µ—Ä–≤—ã–µ 6 (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ)
  –í—Å–µ 6 —É–∂–µ –±—ã–ª–∏
  –õ–æ–≥–∏: "Found 6 items (0 new)"
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**Items Per Query = 6:**
- ‚úÖ –ß–∞—Å—Ç–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (60 —Å–µ–∫)
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
- ‚úÖ –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API

**Items Per Query = 50:**
- ‚ö†Ô∏è  –†–µ–¥–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (5-10 –º–∏–Ω—É—Ç)
- ‚ö†Ô∏è  –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ –∏ –±—ã—Å—Ç—Ä–æ
- ‚ö†Ô∏è  –ë–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ API –∏ –±–∞–∑—É

---

## üîÑ –£–î–ê–õ–ï–ù–û (19 –Ω–æ—è–±—Ä—è 2024)

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

#### 1. Items Per Query –∏ Query Delay –∏–∑ Web UI Config ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å, –±–æ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Web UI

**–†–µ—à–µ–Ω–∏–µ**:
- `core.py` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ì–õ–û–ë–ê–õ–¨–ù–´–ï** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `config.MAX_ITEMS_PER_SEARCH`
- –≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ **hot-reload** –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- Web UI config ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î ‚Üí hot-reload ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º

**–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å**:
1. –ó–∞–π—Ç–∏ –≤ Web UI ‚Üí Config
2. –ò–∑–º–µ–Ω–∏—Ç—å "Items Per Query" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50, –ø–æ—Å—Ç–∞–≤–∏—Ç—å 6)
3. –ò–∑–º–µ–Ω–∏—Ç—å "Query Delay" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300, –ø–æ—Å—Ç–∞–≤–∏—Ç—å 60)
4. –ù–∞–∂–∞—Ç—å Save
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 10 —Å–µ–∫—É–Ω–¥

#### 2. –£–¥–∞–ª—ë–Ω image_compressor.py ‚úÖ
**–ù–µ –Ω—É–∂–µ–Ω** - —É–±—Ä–∞–ª –ª–∏—à–Ω–∏–π –∫–æ–¥

#### 3. –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–æ—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î ‚úÖ
**–£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ** - —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ `image_data = NULL`

### –ü–æ—á–µ–º—É "(0 new)" –≤ –ª–æ–≥–∞—Ö?

–õ–æ–≥–∏ **–ü–†–ê–í–ò–õ–¨–ù–´–ï**:
```
Found 6 items (0 new)
```

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- ‚úÖ API mercari –≤–µ—Ä–Ω—É–ª 6 —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –í—Å–µ 6 —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- ‚ö†Ô∏è –í—Å–µ 6 —Ç–æ–≤–∞—Ä–æ–≤ –£–ñ–ï –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–¥—É–±–ª–∏–∫–∞—Ç—ã)
- ‚ÑπÔ∏è 0 –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–æ

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã —É–∂–µ –±—ã–ª–∏ –Ω–∞–π–¥–µ–Ω—ã —Ä–∞–Ω–µ–µ, –æ–Ω–∏ –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
```
[CONFIG] Hot reload complete! search_interval=60s, max_items=6
Searching: https://... (limit: 6)
```

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å `(limit: 50)` –≤–º–µ—Å—Ç–æ `(limit: 6)` - –∑–Ω–∞—á–∏—Ç:
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Web UI config
2. Hot-reload –µ—â—ë –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª (–ø–æ–¥–æ–∂–¥–∏ 10 —Å–µ–∫—É–Ω–¥)

---

## üîÑ –£–î–ê–õ–ï–ù–û (19 –Ω–æ—è–±—Ä—è 2024 - –≤–µ—á–µ—Ä)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. Web UI –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –§–æ—Ç–æ –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ (100-400KB) —Ç–æ—Ä–º–æ–∑—è—Ç –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç—Ä–∞–Ω–∏—Ü

**–†–µ—à–µ–Ω–∏–µ**:
- –°–æ–∑–¥–∞–Ω `image_compressor.py` - —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è Web UI
- –§—É–Ω–∫—Ü–∏—è `compress_image_data()` - —É–º–µ–Ω—å—à–∞–µ—Ç –¥–æ 400px —à–∏—Ä–∏–Ω—ã, quality=75
- API `/api/items` –∏ `/api/recent-items` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `image_thumbnail`
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```python
from image_compressor import compress_image_data
thumbnail = compress_image_data(image_data_uri, max_width=400, quality=75)
```

#### 2. –ù–µ–≤–µ—Ä–Ω—ã–µ –ª–æ–≥–∏ —Å–∫–∞–Ω–µ—Ä–∞ ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –°–∫–∞–Ω–µ—Ä –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ Web UI (Items Per Query, Query Delay)

**–†–µ—à–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `scan_limit` –≤ —Ç–∞–±–ª–∏—Ü—É `searches` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- –ö–∞–∂–¥—ã–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–º–µ–µ—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
  - `scan_limit` - —Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ —Å–∫–∞—á–∏–≤–∞—Ç—å (1-120)
  - `scan_interval` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ (30-3600 —Å–µ–∫)
- `core.py` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `search.get('scan_limit')` –≤–º–µ—Å—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `MAX_ITEMS_PER_SEARCH`

**–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î**:
```sql
ALTER TABLE searches ADD COLUMN IF NOT EXISTS scan_limit INTEGER DEFAULT 50;
```

**Web UI**:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- Items Per Query (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6)
- Scan Interval (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 —Å–µ–∫—É–Ω–¥)

#### 3. –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–æ—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ —Ñ–æ—Ç–æ –Ω–µ —Å–∫–∞—á–∞–ª–æ—Å—å, —Ç–æ–≤–∞—Ä –Ω–µ –¥–æ–±–∞–≤–ª—è–ª—Å—è –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ**:
- –¢–æ–≤–∞—Ä—ã —Ç–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î **–≤—Å–µ–≥–¥–∞**, –¥–∞–∂–µ –µ—Å–ª–∏ `image_data = NULL`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ: "Failed to download image, will add item without image data"
- –í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `image_url` (high-res URL) –¥–∞–∂–µ –µ—Å–ª–∏ `image_data` –ø—É—Å—Ç

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`core.py`**:
   - `search_query()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `search.get('scan_limit')` –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
   - `_process_new_items()` - —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –±–µ–∑ —Ñ–æ—Ç–æ

2. **`db.py`**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `scan_limit` –≤ —Ç–∞–±–ª–∏—Ü—É `searches`
   - `add_search()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `scan_limit`
   - `update_search()` - –æ–±–Ω–æ–≤–ª—è–µ—Ç `scan_limit` –∏ `scan_interval`

3. **`web_ui_plugin/app.py`**:
   - `/api/items` - —Å–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
   - `/api/recent-items` - —Å–∂–∏–º–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (300px)
   - `/api/queries/<id>` PUT - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç scan_limit –∏ scan_interval

4. **`web_ui_plugin/templates/queries.html`**:
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è Items Per Query –∏ Scan Interval
   - –§–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã

5. **`image_compressor.py`** ‚≠ê (–ù–û–í–´–ô):
   - –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è Web UI
   - –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –Ω–∞ 70-90%
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PIL/Pillow

6. **`requirements.txt`**:
   - –î–æ–±–∞–≤–ª–µ–Ω `Pillow>=10.0.0` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

#### –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
```
Query 1: "Y-3 Shoes"
  - scan_limit: 6
  - scan_interval: 60 —Å–µ–∫—É–Ω–¥
  
Query 2: "Avangarde"
  - scan_limit: 50
  - scan_interval: 300 —Å–µ–∫—É–Ω–¥
```

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!

#### –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```
–û—Ä–∏–≥–∏–Ω–∞–ª –≤ –ë–î: 350KB (base64)
   ‚Üì
Web UI API (/api/items)
   ‚Üì
–°–∂–∞—Ç–∏–µ (400px, quality 75%)
   ‚Üì
Thumbnail: 45KB (base64)
   ‚Üì
–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã!
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ searches (–æ–±–Ω–æ–≤–ª–µ–Ω–∞)
```sql
CREATE TABLE searches (
    ...
    scan_interval INTEGER DEFAULT 300,  -- –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
    scan_limit INTEGER DEFAULT 50,      -- –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç ‚≠ê
    ...
);
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. ‚úÖ Web UI –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ (—Å–∂–∞—Ç—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
2. ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π limit (6, –∞ –Ω–µ 50)
3. ‚úÖ –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Ñ–æ—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ë–î
4. ‚úÖ –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–∏ scan_limit –∏ scan_interval

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 19 –Ω–æ—è–±—Ä—è 2024, –≤–µ—á–µ—Ä
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é ‚úÖ

---

## üîß –§–ò–ù–ê–õ–¨–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø (19 –Ω–æ—è–±—Ä—è 2024 - –ø–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä)

### –ü—Ä–æ–±–ª–µ–º–∞ 1: thread_id - –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ ‚úÖ

**–ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**:
- `db.get_unsent_items()` –∑–∞–≥—Ä—É–∂–∞–µ—Ç `s.thread_id as search_thread_id` –∏–∑ –ë–î
- `simple_telegram_worker.py` —Å—Ç—Ä–æ–∫–∞ 51: `thread_id = item.get('search_thread_id') or self.thread_id`
- –ï—Å–ª–∏ —É search –µ—Å—Ç—å —Å–≤–æ–π thread_id ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω
- –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π TELEGRAM_THREAD_ID

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å**: 
–í Web UI –∫–∞–∂–¥—ã–π search –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π Thread ID!
- Query 1: Thread ID = 31
- Query 2: Thread ID = 32
- –ò —Ç.–¥.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: USD —Ü–µ–Ω–∞ = 0.0 - –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ü—Ä–∏—á–∏–Ω–∞**: `config.USD_CONVERSION_RATE` = 0 –∏–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ**:
```python
usd_rate = config.USD_CONVERSION_RATE
if usd_rate == 0 or usd_rate is None:
    usd_rate = 0.0067  # –î–µ—Ñ–æ–ª—Ç
price_usd = round(price_jpy * usd_rate, 2)
```

**–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å**: 
1. Web UI ‚Üí Config
2. USD Conversion Rate ‚Üí 0.0067
3. Save

### –ü—Ä–æ–±–ª–µ–º–∞ 3: hot-reload –ª–æ–≥–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

**–ë—ã–ª–æ**: –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫ `Search interval changed: 300s ‚Üí 60s`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–µ—à–∞ –ë–î, –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–ê –°–ï–°–°–ò–Æ

1. ‚úÖ High-res –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (1200px+ –≤–º–µ—Å—Ç–æ 240px)
2. ‚úÖ –£–±—Ä–∞–Ω get_item() - 2x –±—ã—Å—Ç—Ä–µ–µ
3. ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ queries - 3-5x –±—ã—Å—Ç—Ä–µ–µ
4. ‚úÖ SQL –±–µ–∑ image_data - 50x –±—ã—Å—Ç—Ä–µ–µ
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ PostgreSQL (RETURNING id, to_dict)
6. ‚úÖ Hot-reload —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
7. ‚úÖ USD —Ü–µ–Ω–∞ —Å –¥–µ—Ñ–æ–ª—Ç–æ–º 0.0067
8. ‚úÖ thread_id —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ò–¢–û–ì–û: –í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –í 100+ –†–ê–ó –ë–´–°–¢–†–ï–ï!** üöÄ

---

**–î–∞—Ç–∞**: 19 –Ω–æ—è–±—Ä—è 2024, 22:30
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–°–Å –ì–û–¢–û–í–û –ö PRODUCTION

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (19 –Ω–æ—è–±—Ä—è 2024 - 23:00)

### –ü–†–û–ë–õ–ï–ú–ê: –¶–∏–∫–ª –ø–æ–∏—Å–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è

**–°–∏–º–ø—Ç–æ–º—ã**:
- –¶–∏–∫–ª –ø–æ–∏—Å–∫–∞ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –ø–æ—Ç–æ–º –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –Ω–∞ 5-10 –º–∏–Ω—É—Ç
- 112 pending notifications –∑–∞—Å—Ç—Ä—è–ª–∏ –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª 8+ –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥

**–ü–†–ò–ß–ò–ù–ê**: `search_and_notify()` –≤—ã–∑—ã–≤–∞–ª `process_pending_notifications()` **–°–ò–ù–•–†–û–ù–ù–û**

```python
def search_and_notify(self):
    results = self.searcher.search_all_queries()  # 30 —Å–µ–∫
    notification_stats = process_pending_notifications()  # 112 items √ó 3 —Å–µ–∫ = 336 —Å–µ–∫!
    # –í–µ—Å—å —Ü–∏–∫–ª –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø –Ω–∞ 6+ –º–∏–Ω—É—Ç!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–æ–≤—ã–π —Ü–∏–∫–ª –ø–æ–∏—Å–∫–∞ **–ù–ï –ú–û–ñ–ï–¢ –ó–ê–ü–£–°–¢–ò–¢–¨–°–Ø**!

---

### –†–ï–®–ï–ù–ò–ï: –î–í–ê –ù–ï–ó–ê–í–ò–°–ò–ú–´–• –ü–†–û–¶–ï–°–°–ê ‚úÖ

**–¢–µ–ø–µ—Ä—å –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ü–∏–∫–ª–∞**:

#### 1. Search Cycle (–¢–û–õ–¨–ö–û –ø–æ–∏—Å–∫)
```python
def search_cycle(self):
    """Search cycle - ONLY searches and adds to DB"""
    results = self.searcher.search_all_queries()
    # –í–°–Å! –ù–∏–∫–∞–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π!
```

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**: –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ (config.SEARCH_INTERVAL)

#### 2. Telegram Cycle (–¢–û–õ–¨–ö–û –æ—Ç–ø—Ä–∞–≤–∫–∞)
```python
def telegram_cycle(self):
    """Telegram notification cycle - INDEPENDENT from search"""
    notification_stats = process_pending_notifications(max_items=10)
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ —Ä–∞–∑
```

**–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ!)

#### Schedule
```python
schedule.every(config.SEARCH_INTERVAL).seconds.do(self.search_cycle)  # 60s
schedule.every(5).seconds.do(self.telegram_cycle)                      # 5s
```

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å:

**Timeline**:
```
00:00 - Search cycle (–ø–æ–∏—Å–∫, 30 —Å–µ–∫)
00:05 - Telegram cycle (10 items, 30 —Å–µ–∫)
00:10 - Telegram cycle (10 items, 30 —Å–µ–∫)
00:15 - Telegram cycle (10 items, 30 —Å–µ–∫)
...
01:00 - Search cycle (–ø–æ–∏—Å–∫, 30 —Å–µ–∫) ‚Üê –ù–ï –ë–õ–û–ö–ò–†–£–ï–¢–°–Ø!
01:05 - Telegram cycle (10 items, 30 —Å–µ–∫)
...
```

**–ü—Ä–æ—Ü–µ—Å—Å—ã –ù–ï–ó–ê–í–ò–°–ò–ú–´**:
- –ü–æ–∏—Å–∫ –ù–ï –∂–¥—ë—Ç Telegram
- Telegram –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–∏—Å–∫
- –û–±–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ schedule

---

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**1. `mercari_notifications.py`**:
- `search_and_notify()` ‚Üí `search_cycle()` (—Ç–æ–ª—å–∫–æ –ø–æ–∏—Å–∫)
- –î–æ–±–∞–≤–ª–µ–Ω `telegram_cycle()` (—Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–∫–∞)
- `_setup_schedule()` - –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**2. `simple_telegram_worker.py`**:
- `process_pending_notifications(max_items=10)` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ 10 –∑–∞ —Ü–∏–∫–ª

---

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:

**112 pending notifications**:
- –û—Ç–ø—Ä–∞–≤—è—Ç—Å—è –∑–∞ 12 —Ü–∏–∫–ª–æ–≤ √ó 5 —Å–µ–∫ = 60 —Å–µ–∫—É–Ω–¥
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å—ë —ç—Ç–æ –≤—Ä–µ–º—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ! ‚úÖ

**–¶–∏–∫–ª –ø–æ–∏—Å–∫–∞**:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è ‚úÖ
- –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ‚úÖ

---

## üìù –ö–û–ù–¢–ï–ö–°–¢ –°–ï–°–°–ò–ò

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –∑–∞ —Å–µ—Å—Å–∏—é:

1. ‚úÖ **High-res –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (1200px+)
2. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ PostgreSQL** - RETURNING id, to_dict()
3. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏**:
   - –£–±—Ä–∞–Ω –ª–∏—à–Ω–∏–π get_item() ‚Üí 2x –±—ã—Å—Ç—Ä–µ–µ
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ queries ‚Üí 3-5x –±—ã—Å—Ç—Ä–µ–µ
   - SQL –±–µ–∑ image_data ‚Üí 50x –±—ã—Å—Ç—Ä–µ–µ
   - **–ò–¢–û–ì–û: 100+ —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!**
4. ‚úÖ **Hot-reload** - –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
5. ‚úÖ **USD —Ü–µ–Ω–∞** - –¥–µ—Ñ–æ–ª—Ç 0.0067
6. ‚úÖ **thread_id** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
7. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã** - –ø–æ–∏—Å–∫ –∏ Telegram –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

---

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

**–ì–æ—Ç–æ–≤–æ –∫ production**: ‚úÖ

**–ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è**:
1. Web UI ‚Üí Config ‚Üí USD Conversion Rate ‚Üí 0.0067
2. Web UI ‚Üí Queries ‚Üí –¥–ª—è –∫–∞–∂–¥–æ–≥–æ query –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Thread ID (31, 32, 33...)

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**:
- –ü–æ–∏—Å–∫: –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- Telegram: –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–¥–æ 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- Web UI: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

---

**–î–∞—Ç–∞**: 19 –Ω–æ—è–±—Ä—è 2024, 23:00
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–°–Å –ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ì–û–¢–û–í–û
**–ò—Ç–µ—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ**: 32/30 (–ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

---

## üéâ VERSION 1.1 - PRODUCTION RELEASE (19 –Ω–æ—è–±—Ä—è 2024, 23:30)

### –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å–∏—è**: 1.1
**–°—Ç–∞—Ç—É—Å**: ‚úÖ PRODUCTION READY
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞**: 19 –Ω–æ—è–±—Ä—è 2024

### –í—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. ‚úÖ **High-res –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (1200px+)
2. ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ queries** - –¥–æ 20 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. ‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã** - search (60s) + telegram (5s)
4. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏** - 100x –±—ã—Å—Ç—Ä–µ–µ
5. ‚úÖ **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Web UI** - –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
6. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –±–∞–≥–∏ PostgreSQL** - RETURNING id, to_dict
7. ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç items** - —Ä–µ–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ per query
8. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤** - —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
9. ‚úÖ **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –ª–æ–≥–∏** - —É–º–µ–Ω—å—à–µ–Ω padding —Å—Ç—Ä–æ–∫
10. ‚úÖ **Thread-safe API** - –∫–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ —Å–≤–æ–π API instance

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:

- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 100+ queries** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **max_workers = 20** (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è Railway)
- **Query Delay = 60 —Å–µ–∫** (–≥–ª–æ–±–∞–ª—å–Ω—ã–π)
- **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ scan_interval** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ query

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- **100 queries**: ~25-30 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ü–∏–∫–ª
- **Web UI**: –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- **Telegram**: 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–ü–æ–∏—Å–∫**: –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

- ‚úÖ –ê–≤—Ç–æ—Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ù–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è
- ‚úÖ Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ 257 items –≤ –±–∞–∑–µ, 0 unsent
- ‚úÖ Force Scan –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ production
2. –î–æ–±–∞–≤–ª—è—Ç—å queries –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å USD Conversion Rate = 0.0067
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Thread ID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ query

---

**–î–∞—Ç–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ª–∏–∑–∞**: 19 –Ω–æ—è–±—Ä—è 2024, 23:30
**Git tag**: v1.1
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION

---

## üöÄ VERSION 1.2 - WEB UI & AUTO-SCAN FIXES (20 –Ω–æ—è–±—Ä—è 2024)

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### 1. Auto-scan –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –Ω–∞ Railway ‚ùå‚Üí‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: Background scheduler –≤–æ–æ–±—â–µ –ù–ï –ó–ê–ü–£–°–ö–ê–õ–°–Ø –Ω–∞ Railway
- –í `wsgi.py` –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–º–ø–æ—Ä—Ç: `from mercari_notifications import MercariApp`
- –ù–æ –∫–ª–∞—Å—Å –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `MercariNotificationApp`
- –ü–æ–ª—É—á–∞–ª—Å—è `ImportError`, scheduler –ø–∞–¥–∞–ª –º–æ–ª—á–∞
- –†–∞–±–æ—Ç–∞–ª —Ç–æ–ª—å–∫–æ manual "Force Scan All" —á–µ—Ä–µ–∑ Web UI

**–†–µ—à–µ–Ω–∏–µ**:
```python
# –ë—ã–ª–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
from mercari_notifications import MercariApp

# –°—Ç–∞–ª–æ (–ü–†–ê–í–ò–õ–¨–ù–û):
from mercari_notifications import MercariNotificationApp
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `wsgi.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –∫–ª–∞—Å—Å–∞
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ —Å traceback

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ Auto-scan —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥

---

#### 2. USD —Ü–µ–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ $0.00 ‚ùå‚Üí‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ —Ü–µ–Ω—ã –≤ Web UI –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –∫–∞–∫ $0.00
- `config_usd_conversion_rate` –Ω–µ –±—ã–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ –ë–î
- –ü—Ä–∏ hot-reload config.USD_CONVERSION_RATE –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–ª—Å—è –Ω—É–ª—ë–º

**–†–µ—à–µ–Ω–∏–µ (3 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã)**:

**–£—Ä–æ–≤–µ–Ω—å 1 - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î**:
```python
# db.py
def _ensure_default_config(self):
    usd_rate = self.load_config('config_usd_conversion_rate')
    if usd_rate is None or usd_rate == 0:
        self.save_config('config_usd_conversion_rate', 0.0067)
```

**–£—Ä–æ–≤–µ–Ω—å 2 - Safe Config –≤ app.py**:
```python
def get_safe_config():
    """Get config with fallback for USD_CONVERSION_RATE"""
    safe_config = type('SafeConfig', (object,), {
        'USD_CONVERSION_RATE': config.USD_CONVERSION_RATE or 0.0067
    })()
    # Copy all other attributes...
    return safe_config
```

**–£—Ä–æ–≤–µ–Ω—å 3 - JavaScript fallback**:
```javascript
// dashboard.html, items.html
const usdRate = {{ config.USD_CONVERSION_RATE }} || 0.0067;
const usdPrice = (item.price * usdRate).toFixed(2);
```

**Jinja2 template fallback**:
```jinja2
{# items.html #}
${{ (item.price * (config.USD_CONVERSION_RATE or 0.0067))|round(2) }}
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `db.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ `_ensure_default_config()`
- `web_ui_plugin/app.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ `get_safe_config()`, –≤—Å–µ routes –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ—ë
- `web_ui_plugin/templates/dashboard.html` - JS fallback
- `web_ui_plugin/templates/items.html` - JS + Jinja2 fallback

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –¶–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ config –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

#### 3. Timestamps —Å –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞–º–∏ ‚ùå‚Üí‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: Timestamps –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Å –ª–∏—à–Ω–∏–º–∏ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞–º–∏
```
2025-11-19 22:43:32.585535 GMT+3
                   ^^^^^^^^ <- –Ω–µ–Ω—É–∂–Ω—ã–µ
```

**–†–µ—à–µ–Ω–∏–µ**:

**Python —Ñ—É–Ω–∫—Ü–∏—è –≤ app.py**:
```python
def clean_timestamp(ts_str):
    """Remove microseconds from timestamp string"""
    if '.' in ts_str:
        parts = ts_str.split('.')
        # Split at dot, keep timezone if present
        if ' ' in parts[1]:
            tz_part = parts[1].split(' ', 1)[1]
            return f"{parts[0]} {tz_part}".strip()
        return parts[0]
    return ts_str
```

**Jinja2 —Ñ–∏–ª—å—Ç—Ä**:
```python
@app.template_filter('clean_timestamp')
def clean_timestamp_filter(ts):
    return clean_timestamp(str(ts)) if ts else ''
```

**JavaScript —Ñ—É–Ω–∫—Ü–∏—è**:
```javascript
function cleanTimestamp(ts) {
    if (ts.includes('.')) {
        const parts = ts.split('.');
        if (parts[1].includes(' ')) {
            const tzPart = parts[1].split(' ').slice(1).join(' ');
            return tzPart ? `${parts[0]} ${tzPart}` : parts[0];
        }
        return parts[0];
    }
    return ts;
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```jinja2
{# templates #}
{{ item.found_at|clean_timestamp }}
```

```javascript
// JavaScript
${cleanTimestamp(item.found_at)}
```

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `web_ui_plugin/app.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `clean_timestamp()` –∏ —Ñ–∏–ª—å—Ç—Ä
- `web_ui_plugin/templates/items.html` - Jinja2 —Ñ–∏–ª—å—Ç—Ä + JS —Ñ—É–Ω–∫—Ü–∏—è
- `web_ui_plugin/templates/dashboard.html` - JS —Ñ—É–Ω–∫—Ü–∏—è
- `web_ui_plugin/templates/logs.html` - –ø—Ä–∏–º–µ–Ω—ë–Ω clean_timestamp

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ Timestamps —Ç–µ–ø–µ—Ä—å —á–∏—Å—Ç—ã–µ: `2025-11-19 22:43:32 GMT+3`

---

#### 4. Dark theme - white flash –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ dark theme –±—ã–ª –±–µ–ª—ã–π "–º–µ–ª—ë–∫"

**–†–µ—à–µ–Ω–∏–µ (—Ç—Ä–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞)**:
1. Inline script –≤ `<head>` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `data-theme` –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ CSS
2. Critical inline CSS –ø–µ—Ä–µ–¥ Bootstrap —Å `!important`
3. Inline styles –Ω–∞ `documentElement`

**–ö–æ–¥ –≤ base.html**:
```html
<head>
    <!-- Prevent white flash - BEFORE CSS! -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.style.backgroundColor = '#0d1117';
                document.documentElement.style.color = '#f0f6fc';
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <!-- Critical inline CSS -->
    <style>
        [data-theme="dark"] body {
            background-color: #0d1117 !important;
            color: #f0f6fc !important;
        }
        [data-theme="dark"] .navbar {
            background-color: #161b22 !important;
        }
    </style>

    <!-- Bootstrap CSS loads AFTER -->
    <link href="...bootstrap.min.css">
</head>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –ë–µ–ª—ã–π flash –∏—Å—á–µ–∑

---

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### test_search_logic.py
–î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ auto-scan –ª–æ–≥–∏–∫–∏:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ searches –∏ –∏—Ö readiness
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `get_searches_ready_for_scan()`
- –í—ã–≤–æ–¥–∏—Ç recent items

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
python3 test_search_logic.py
```

#### fix_usd_rate.py
Emergency fix –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ USD_CONVERSION_RATE:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 0.0067
- –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```bash
python3 fix_usd_rate.py
```

---

### –ò—Ç–æ–≥–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞ —Å–µ—Å—Å–∏—é

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
1. `wsgi.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π ImportError
2. `db.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è config
3. `web_ui_plugin/app.py` - safe config + timestamp cleaning
4. `web_ui_plugin/templates/base.html` - dark theme flash fix
5. `web_ui_plugin/templates/dashboard.html` - USD fallback + timestamp cleaning
6. `web_ui_plugin/templates/items.html` - USD fallback + timestamp cleaning

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã**:
1. `test_search_logic.py` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ auto-scan
2. `fix_usd_rate.py` - emergency USD rate fix

**Commits**:
1. `critical: Fix auto-scan not working on Railway` (657c1be)
2. `fix: USD prices showing as $0.00 in Web UI` (e8e1146)
3. `fix: Remove microseconds from timestamps + safe USD config` (pending)

---

### –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

**–í–µ—Ä—Å–∏—è**: 1.2
**–î–∞—Ç–∞**: 20 –Ω–æ—è–±—Ä—è 2024, 01:30 MSK
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò –ò–°–ü–†–ê–í–õ–ï–ù–´

**–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
- ‚úÖ Auto-scan –Ω–∞ Railway (–∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥)
- ‚úÖ USD —Ü–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Timestamps –±–µ–∑ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥
- ‚úÖ Dark theme –±–µ–∑ white flash
- ‚úÖ Web UI –±—ã—Å—Ç—Ä–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ

**–ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å**:
1. –í Web UI ‚Üí Config ‚Üí USD Conversion Rate –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0.0067
2. –ö–∞–∂–¥—ã–π query –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å Thread ID
3. Scan Interval –∏ Scan Limit –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 20 –Ω–æ—è–±—Ä—è 2024, 01:30 MSK
**–°—Ç–∞—Ç—É—Å**: ‚úÖ READY FOR PRODUCTION
