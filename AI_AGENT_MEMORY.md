# ü§ñ AI AGENT MEMORY - MercariSearcher Bot

## ‚ö†Ô∏è –ü–û–°–¢–û–Ø–ù–ù–´–ï –ü–†–ê–í–ò–õ–ê

### –ü—Ä–∞–≤–∏–ª–æ 1: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å** –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û** —ç—Ç–æ—Ç —Ñ–∞–π–ª `AI_AGENT_MEMORY.md`
- –í—Å–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç - –¢–û–õ–¨–ö–û –ó–î–ï–°–¨
- **–ù–ï —Ç—Ä–∞—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã** –Ω–∞ –±–µ—Å–ø–æ–ª–µ–∑–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –ü—Ä–∞–≤–∏–ª–æ 2: –ö–æ–º–∞–Ω–¥–∞ "–ó–ê–ü–û–ú–ù–ò!"
- –ü–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–ó–ê–ü–û–ú–ù–ò!" –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª
- –ü—Ä–∞–≤–∏–ª–∞ –¥–µ–π—Å—Ç–≤—É—é—Ç –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π

### –ü—Ä–∞–≤–∏–ª–æ 3: –ö–æ–º–∞–Ω–¥–∞ "–ó–ê–ü–û–ú–ù–ò –ö–û–ù–¢–ï–ö–°–¢!"
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª
- –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ AI –∞–≥–µ–Ω—Ç–∞–º–∏

---

## üìã –û –ü–†–û–ï–ö–¢–ï: MercariSearcher Bot

### –ß—Ç–æ —ç—Ç–æ?
Telegram –±–æ—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Mercari.jp (—è–ø–æ–Ω—Å–∫–∏–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å). –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ò—â–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- **–§–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ**
- –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ –≤ –í–´–°–û–ö–û–ú —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ (–≤–∫–ª—é—á–∞—è shops —Ç–æ–≤–∞—Ä—ã)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

**–í–µ—Ä—Å–∏—è**: 1.3
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 22 –Ω–æ—è–±—Ä—è 2024

### –û—Å–Ω–æ–≤–∞
- **–Ø–∑—ã–∫**: Python 3
- **API –±–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `mercapi` (v0.4.2+)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL –Ω–∞ Railway
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞**: Railway (Gunicorn + integrated scheduler)
- **Telegram**: python-telegram-bot
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: -70% DB I/O, -15% CPU

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
gunicorn (wsgi.py)
  ‚îî‚îÄ> post_fork hook –∑–∞–ø—É—Å–∫–∞–µ—Ç scheduler
       ‚îî‚îÄ> mercari_notifications.py (MercariNotificationApp)
            ‚îú‚îÄ> search_cycle() –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫
            ‚îÇ   ‚îî‚îÄ> core.py (MercariSearcher)
            ‚îÇ       ‚îú‚îÄ> pyMercariAPI/mercari.py - –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ mercapi
            ‚îÇ       ‚îÇ   ‚îî‚îÄ> –ò–∑–≤–ª–µ–∫–∞–µ—Ç category –∏–∑ item.item_category.name
            ‚îÇ       ‚îú‚îÄ> –§–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π (CATEGORY_BLACKLIST)
            ‚îÇ       ‚îú‚îÄ> image_handler.py - HIGH-RES —Ñ–æ—Ç–æ
            ‚îÇ       ‚îî‚îÄ> db.py - PostgreSQL
            ‚îÇ
            ‚îî‚îÄ> telegram_cycle() –∫–∞–∂–¥—ã–µ 35 —Å–µ–∫
                ‚îî‚îÄ> simple_telegram_worker.py - –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram

web_ui_plugin/app.py
  ‚îî‚îÄ> Flask Web UI
      ‚îú‚îÄ> Dashboard
      ‚îú‚îÄ> Items (–∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–æ–∏—Å–∫)
      ‚îú‚îÄ> Queries
      ‚îú‚îÄ> Config (Category Filter)
      ‚îî‚îÄ> Logs
```

---

## üÜï –ü–û–°–õ–ï–î–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø (22 –Ω–æ—è–±—Ä—è 2024)

### 1. –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚úÖ

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –í–°–ï–• –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –î–û —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Web UI —Å –±—ã—Å—Ç—Ä—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
- Hot-reload: –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. `pyMercariAPI/mercari.py` –∏–∑–≤–ª–µ–∫–∞–µ—Ç `item.item_category.name` –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
2. `core.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ blacklist
3. –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Ç–æ–≤–∞—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
4. –í –ª–æ–≥–∞—Ö: `[FILTER] üö´ Item rejected: category '...' is blacklisted`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
- Web UI ‚Üí Config ‚Üí Category Filter
- –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–¥–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É):
  ```
  „Ç≤„Éº„É†„Éª„Åä„ÇÇ„Å°„ÇÉ„Éª„Ç∞„ÉÉ„Ç∫
  Êú¨„ÉªÈü≥Ê•Ω„Éª„Ç≤„Éº„É†
  ```
- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏: üéÆ Games & Toys, üìö Books & Music, üé™ Entertainment, üë∂ Baby & Kids

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- –ö–ª—é—á: `config_category_blacklist`
- –§–æ—Ä–º–∞—Ç: JSON array `["„Ç≤„Éº„É†„Éª„Åä„ÇÇ„Å°„ÇÉ„Éª„Ç∞„ÉÉ„Ç∫", "Êú¨„ÉªÈü≥Ê•Ω„Éª„Ç≤„Éº„É†"]`

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `configuration_values.py` - –¥–æ–±–∞–≤–ª–µ–Ω CATEGORY_BLACKLIST + hot-reload (60s)
- `core.py` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ _process_new_items()
- `pyMercariAPI/mercari.py` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ category –ø—Ä–∏ search()
- `web_ui_plugin/templates/config.html` - UI —Å–µ–∫—Ü–∏—è Category Filter
- `web_ui_plugin/app.py` - –∑–∞–≥—Ä—É–∑–∫–∞ blacklist –∏–∑ –ë–î

**Commits:**
- `3869da4` - feat: Add global category blacklist filter
- `2bee67a` - fix: Extract category in search() to enable blacklist filtering

---

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤ Railway (-70% DB I/O) ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–≤–∞–ª–æ 500+ –∑–∞–ø–∏—Å–µ–π/—á–∞—Å –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**

**Hot-reload: 10s ‚Üí 60s**
- –≠–∫–æ–Ω–æ–º–∏—è: 83% –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (6 –≤–º–µ—Å—Ç–æ 360/—á–∞—Å)

**Telegram Worker:**
- –£–±—Ä–∞–Ω–æ 8 –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö `db.add_log_entry()` –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏—Ç–æ–≥: `[TELEGRAM] Sent X/Y notifications`
- –≠–∫–æ–Ω–æ–º–∏—è: 90% –∑–∞–ø–∏—Å–µ–π

**Scheduler:**
- –£–±—Ä–∞–Ω—ã –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è + –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
- –≠–∫–æ–Ω–æ–º–∏—è: 83% –ª–æ–≥–æ–≤

**Search Cycle:**
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –£–±—Ä–∞–Ω–æ "CALLED at..." –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ

**–ò—Ç–æ–≥–æ:**
- Database I/O: -70-80%
- CPU usage: -15-20%
- –õ–æ–≥–æ–≤ –≤ –ë–î: ~50-100/—á–∞—Å (–±—ã–ª–æ 500+)
- **–û–∂–∏–¥–∞–µ–º–∞—è —ç–∫–æ–Ω–æ–º–∏—è: $3-5/–º–µ—Å—è—Ü**

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `configuration_values.py` - _reload_interval = 60
- `simple_telegram_worker.py` - —É–±—Ä–∞–Ω–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `mercari_notifications.py` - –ª–æ–≥–∏ —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**Commit:**
- `03dd809` - perf: Optimize logging and hot-reload to reduce Railway costs

---

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ –¥–ª—è Mercari Shops ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–≤–∞—Ä—ã `/shops/product/*` –Ω–µ –∏–º–µ–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ë–î

**–ü—Ä–∏—á–∏–Ω–∞:**
- –î–ª—è shops —Ç–æ–≤–∞—Ä–æ–≤ `photos[]` –±—ã–ª –ø—É—Å—Ç—ã–º
- –ö–æ–¥ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª fallback –Ω–∞ `thumbnails[]`

**–†–µ—à–µ–Ω–∏–µ:**
1. Fallback –Ω–∞ `thumbnails` –∏ `thumbnail` –µ—Å–ª–∏ `photos` –ø—É—Å—Ç–æ
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –¥–æ high-res (w_1200)
3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è shops —Ñ–æ—Ä–º–∞—Ç–∞: `/-/small/` ‚Üí `/-/large/`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ:**
1. `photos[0]` - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤)
2. `thumbnails[0]` - –∞–ø–≥—Ä–µ–π–¥ –¥–æ w_1200 (–¥–ª—è shops)
3. `thumbnail` - –∞–ø–≥—Ä–µ–π–¥ –¥–æ w_1200 (–ø–æ—Å–ª–µ–¥–Ω–∏–π fallback)

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `pyMercariAPI/mercari.py` - fallback –Ω–∞ thumbnails + –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è shops URLs

**Commit:**
- `d4d4f0a` - fix: Add image URLs for Mercari Shops products

---

### 4. –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π UI –ø–æ–∏—Å–∫–∞ –≤ Items ‚úÖ

**–ë—ã–ª–æ:** –ë–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å –ª–µ–π–±–ª–∞–º–∏, –∫–Ω–æ–ø–∫–∞–º–∏, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏  
**–°—Ç–∞–ª–æ:** –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ `[___–ü–æ–∏—Å–∫___] [X] [üîç]`

**–ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `web_ui_plugin/templates/items.html` - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π input-group

**Commit:**
- `c3e34b4` - ui: Make items search bar compact - single line with search icon

---

## üîß –ö–õ–Æ–ß–ï–í–´–ï –§–ê–ô–õ–´

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏
- `mercari_notifications.py` - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (search_cycle + telegram_cycle)
- `core.py` - MercariSearcher, –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `image_handler.py` - –∑–∞–≥—Ä—É–∑–∫–∞ HIGH-RES –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `db.py` - PostgreSQL, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `simple_telegram_worker.py` - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `configuration_values.py` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + hot-reload (60s)

### API –æ–±—ë—Ä—Ç–∫–∞
- `pyMercariAPI/mercari.py` - –æ–±—ë—Ä—Ç–∫–∞ –≤–æ–∫—Ä—É–≥ mercapi, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ category
- `pyMercariAPI/items.py` - –∫–ª–∞—Å—Å—ã Item/Items
- `pyMercariAPI/exceptions.py` - –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### Web UI
- `web_ui_plugin/app.py` - Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, safe config
- `web_ui_plugin/templates/config.html` - Category Filter UI
- `web_ui_plugin/templates/items.html` - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –ø–æ–∏—Å–∫

### Deployment
- `wsgi.py` - entry point –¥–ª—è Gunicorn
- `gunicorn_config.py` - post_fork hook –¥–ª—è –∑–∞–ø—É—Å–∫–∞ scheduler
- `Procfile` - Railway deployment (—Ç–æ–ª—å–∫–æ web –ø—Ä–æ—Ü–µ—Å—Å)

---

## üìä –ë–ê–ó–ê –î–ê–ù–ù–´–• (PostgreSQL)

### –¢–∞–±–ª–∏—Ü–∞ `items`
```sql
id              SERIAL PRIMARY KEY
mercari_id      VARCHAR(50) UNIQUE
title           TEXT
price           INTEGER
image_url       TEXT              -- HIGH-RES URL
image_data      TEXT              -- Base64 encoded (nullable)
category        TEXT              -- —è–ø–æ–Ω—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚≠ê
is_sent         BOOLEAN
sent_at         TIMESTAMP
found_at        TIMESTAMP
item_url        TEXT
```

### –¢–∞–±–ª–∏—Ü–∞ `key_value_store`
```sql
key             TEXT PRIMARY KEY
value           TEXT              -- JSON –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
updated_at      TIMESTAMP
```

**–í–∞–∂–Ω—ã–µ –∫–ª—é—á–∏:**
- `config_category_blacklist` - JSON array blacklisted –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- `config_search_interval` - –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–∏—Å–∫–∞ (—Å–µ–∫—É–Ω–¥—ã)
- `config_usd_conversion_rate` - –∫—É—Ä—Å JPY‚ÜíUSD (default: 0.0067)

---

## üöÄ RAILWAY DEPLOYMENT

### Project
```bash
railway link
git push
railway logs -f
```

### Procfile
```
web: gunicorn --config gunicorn_config.py --bind 0.0.0.0:$PORT wsgi:application
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Worker –ø—Ä–æ—Ü–µ—Å—Å –ù–ï –Ω—É–∂–µ–Ω! Scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `gunicorn_config.py:post_fork`

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
DATABASE_URL=postgresql://...
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...
PROXY_ENABLED=false     # —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞—é—Ç –ë–ï–ó –ø—Ä–æ–∫—Å–∏!
```

---

## üîç –í–ê–ñ–ù–´–ï –î–ï–¢–ê–õ–ò

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (search)**
```python
# pyMercariAPI/mercari.py - –º–µ—Ç–æ–¥ search()
item_category = None
if hasattr(item, 'item_category') and item.item_category:
    if hasattr(item.item_category, 'name'):
        item_category = item.item_category.name  # "„Ç≤„Éº„É†„Éª„Åä„ÇÇ„Å°„ÇÉ„Éª„Ç∞„ÉÉ„Ç∫"

item_dict['category'] = item_category
```

**2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (core.py)**
```python
# core.py - –º–µ—Ç–æ–¥ _process_new_items()
item_category = getattr(full_item, 'category', None)
item_rejected = False

if item_category and config.CATEGORY_BLACKLIST:
    for blacklisted_cat in config.CATEGORY_BLACKLIST:
        if blacklisted_cat in item_category:
            logger.info(f"[FILTER] üö´ Item rejected: category '{item_category}' is blacklisted")
            item_rejected = True
            break

if item_rejected:
    continue  # –¢–æ–≤–∞—Ä –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
```

**3. Hot-reload –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
```python
# configuration_values.py - –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
if 'config_category_blacklist' in new_config:
    blacklist_data = new_config['config_category_blacklist']
    if isinstance(blacklist_data, list):
        cls.CATEGORY_BLACKLIST = blacklist_data
    elif isinstance(blacklist_data, str):
        cls.CATEGORY_BLACKLIST = json.loads(blacklist_data)
```

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç 1: Web UI ‚Üí Items**
- –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä –≤ —Å–ø–∏—Å–∫–µ
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–ª–æ–Ω–∫—É "Category"
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —è–ø–æ–Ω—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–≥–∏**
```
[FILTER] üö´ Item rejected: category '„Ç≤„Éº„É†„Éª„Åä„ÇÇ„Å°„ÇÉ„Éª„Ç∞„ÉÉ„Ç∫' is blacklisted
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
```sql
SELECT DISTINCT category FROM items WHERE category IS NOT NULL;
```

### –§–æ—Ä–º–∞—Ç blacklist
```
„Ç≤„Éº„É†„Éª„Åä„ÇÇ„Å°„ÇÉ„Éª„Ç∞„ÉÉ„Ç∫  ‚Üê —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
„Ç≤„Éº„É†                    ‚Üê —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å "„Ç≤„Éº„É†")
```

–§–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `in`, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è, —Ç–∞–∫ –∏ —á–∞—Å—Ç–∏.

---

## üí° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –†–ê–°–•–û–î–û–í

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)
- **1 –ø—Ä–æ—Ü–µ—Å—Å** (Gunicorn web + integrated scheduler)
- **Hot-reload:** 60 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 10)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- **Database I/O:** -70-80%
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** ~$5-7/–º–µ—Å –Ω–∞ Railway Hobby

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ö–æ—Å—Ç–∏–Ω–≥–∏ (–¥–µ—à–µ–≤–ª–µ)

| –•–æ—Å—Ç–∏–Ω–≥ | –¶–µ–Ω–∞/–º–µ—Å | Free tier | Postgres | Git push | Sleep |
|---------|----------|-----------|----------|----------|-------|
| **Fly.io** | $0-3 | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| **Render** | $0-7 | ‚úÖ 750h | ‚úÖ | ‚úÖ | ‚ö†Ô∏è Free —Å–ø–∏—Ç |
| **Railway** | $5-20 | ‚ùå | ‚úÖ | ‚úÖ | ‚ùå |
| **Heroku** | $5-7 | ‚ùå | ‚úÖ | ‚úÖ | ‚ö†Ô∏è Eco —Å–ø–∏—Ç |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** Fly.io –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ ($0-3/–º–µ—Å)

---

## üìù –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 22 –Ω–æ—è–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ PRODUCTION READY  
**–í–µ—Ä—Å–∏—è**: 1.3

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ mercapi
- ‚úÖ **–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ HIGH-RES —Ñ–æ—Ç–æ (–æ–±—ã—á–Ω—ã–µ + shops —Ç–æ–≤–∞—Ä—ã)
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (-70% DB I/O)**
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ Web UI —Å –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
- ‚úÖ Hot-reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (60s)

### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
```
2bee67a - fix: Extract category in search() to enable blacklist filtering
d4d4f0a - fix: Add image URLs for Mercari Shops products
03dd809 - perf: Optimize logging and hot-reload to reduce Railway costs
c3e34b4 - ui: Make items search bar compact - single line with search icon
3869da4 - feat: Add global category blacklist filter
```

---

## üîß TROUBLESHOOTING

### –§–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞ —Ç–æ—á–Ω–æ –∫–∞–∫ –Ω–∞ Mercari (—è–ø–æ–Ω—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã)
2. –ü–æ–¥–æ–∂–¥–∏ 60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (hot-reload)
3. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `[CONFIG] Category blacklist loaded: X categories`
4. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `item.category` –Ω–µ `None` –≤ –ë–î

### –§–æ—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–ª—è shops —Ç–æ–≤–∞—Ä–æ–≤
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–º–∏—Ç–µ `d4d4f0a`
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `image_url` —Å–æ–¥–µ—Ä–∂–∏—Ç `/-/large/` –¥–ª—è shops —Ç–æ–≤–∞—Ä–æ–≤
- –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: `Using thumbnail for shops product`

### –ú–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥–∞—Ö –ë–î
- –ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ `03dd809` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~50-100 –∑–∞–ø–∏—Å–µ–π/—á–∞—Å
- –ï—Å–ª–∏ –±–æ–ª—å—à–µ - –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ hot-reload —Ä–∞–±–æ—Ç–∞–µ—Ç —Ä–∞–∑ –≤ 60 —Å–µ–∫—É–Ω–¥
- –õ–æ–≥–∏: `[CONFIG] ‚úÖ Hot reload complete! ... blacklist=X`

---

*–≠—Ç–æ—Ç —Ñ–∞–π–ª - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤.*
*–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.*

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 22 –Ω–æ—è–±—Ä—è 2024, 15:00 MSK  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.3  
**–ê–≤—Ç–æ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π**: AI Agent (–∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è + –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
