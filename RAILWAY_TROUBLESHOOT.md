# üî• –°–†–û–ß–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê - –ê–≤—Ç–æ—Å–∫–∞–Ω–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Railway

## ‚úÖ –ß—Ç–æ –¢–û–ß–ù–û —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ:

```
‚úÖ Scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
‚úÖ Jobs scheduled: 4
‚úÖ Search cycle: –∫–∞–∂–¥—ã–µ 300s (5 –º–∏–Ω—É—Ç)
‚úÖ Telegram cycle: –∫–∞–∂–¥—ã–µ 35s
‚úÖ Config hot reload —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ Blacklist –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (2 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
‚úÖ Heartbeat –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã —É—Å–ø–µ—à–Ω—ã
```

## üîç –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –ù–ê RAILWAY:

### –®–ê–ì–ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:

#### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–ø–ª–æ–π (–ü–ï–†–í–´–ú –î–ï–õ–û–ú!)

–û—Ç–∫—Ä–æ–π—Ç–µ: https://railway.app/project/f17da572-14c9-47b5-a9f1-1b6d5b6dea2d

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π = commit `52abff1` –∏–ª–∏ `b145d39`
- ‚úÖ Status = Success (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)
- ‚úÖ Time = –Ω–µ–¥–∞–≤–Ω–µ–µ –≤—Ä–µ–º—è

**–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π —Å—Ç–∞—Ä—ã–π:**
- Railway –º–æ–≥ –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –†–µ—à–µ–Ω–∏–µ: –ù–∞–∂–∞—Ç—å "Redeploy" –≤—Ä—É—á–Ω—É—é

---

#### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (–ö–õ–Æ–ß–ï–í–û–ô –®–ê–ì!)

–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ Railway –∏ –∏—â–∏—Ç–µ:

**‚úÖ –•–û–†–û–®–ò–ï –ó–ù–ê–ö–ò (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å):**
```
‚úÖ Background scheduler thread started with auto-restart
‚úÖ Health check monitor started
‚úÖ [SCHEDULER] ‚è∞ Entering main loop...
‚úÖ [SCHEDULER] Jobs scheduled: 4
‚úÖ [SCHEDULER] ‚è∞ First run_pending() completed
```

**‚ùå –ü–õ–û–•–ò–ï –ó–ù–ê–ö–ò (–ø—Ä–æ–±–ª–µ–º—ã):**
```
‚ùå Application crashed
‚ùå ImportError / ModuleNotFoundError
‚ùå SyntaxError
‚ùå Database connection failed
‚ùå No logs at all (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è)
```

**‚ö†Ô∏è –°–¢–†–ê–ù–ù–´–ï –ó–ù–ê–ö–ò (—Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è):**
```
‚ö†Ô∏è –õ–æ–≥–∏ –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç "[SCHEDULER] Loop alive! Iteration X"
‚ö†Ô∏è –õ–æ–≥–∏ –æ–±—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ "[SCHEDULER] Entering main loop..."
‚ö†Ô∏è [DB ERROR] Failed to reconnect (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)
```

---

#### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í Railway ‚Üí Settings ‚Üí Variables –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

**–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï:**
```
DATABASE_URL=postgresql://...  (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

**–û–ü–¶–ò–û–ù–ê–õ–¨–ù–´–ï (–¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã):**
```
TELEGRAM_BOT_TOKEN=...  (–µ—Å–ª–∏ –Ω–µ—Ç - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ —Å–∫–∞–Ω–µ—Ä –î–û–õ–ñ–ï–ù)
TELEGRAM_CHAT_ID=...
```

---

#### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL

–í Railway ‚Üí PostgreSQL service ‚Üí Data:

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `items` - –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ?
- `searches` - –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏?
- `config` - –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?

**–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç:**
- –ë–î –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å
- –ü—Ä–æ–±–ª–µ–º–∞ –≤ `db.py` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## üöÄ –ë–´–°–¢–†–´–ï –†–ï–®–ï–ù–ò–Ø:

### –†–µ—à–µ–Ω–∏–µ 1: Force Redeploy
```
railway service  # –í—ã–±—Ä–∞—Ç—å –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å
railway restart
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Dashboard: Deployments ‚Üí –Ω–∞–∂–∞—Ç—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π ‚Üí "Redeploy"

### –†–µ—à–µ–Ω–∏–µ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Procfile –∏ start.sh

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Procfile –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
```
web: bash start.sh
```

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ start.sh –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
```bash
gunicorn wsgi:application --bind 0.0.0.0:$PORT
```

### –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Gunicorn workers

–ï—Å–ª–∏ Gunicorn –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ workers, scheduler –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

–í `gunicorn_config.py` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```python
workers = 1  # –¢–û–õ–¨–ö–û 1 worker –¥–ª—è scheduler!
```

### –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timeout

–ï—Å–ª–∏ Railway —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ timeout, –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å:
```python
timeout = 300  # –í gunicorn_config.py
```

---

## üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:

### –ß–µ—Ä–µ–∑ Railway CLI:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø—Ä–æ–µ–∫—Ç—É
railway link -p f17da572-14c9-47b5-a9f1-1b6d5b6dea2d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
railway logs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
railway variables

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
railway restart

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
railway connect  # –í—ã–±—Ä–∞—Ç—å PostgreSQL
# –ó–∞—Ç–µ–º –≤ psql:
\dt  # –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
SELECT COUNT(*) FROM items;
SELECT * FROM searches WHERE is_active = true;
SELECT * FROM config;
```

---

## üìä –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:

### –í–∞—Ä–∏–∞–Ω—Ç A: –ï—Å–ª–∏ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
2. –ù–∞–π–¥–∏—Ç–µ –≤ –∫–∞–∫–æ–º —Ñ–∞–π–ª–µ –æ—à–∏–±–∫–∞
3. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –∏ —Å–¥–µ–ª–∞–π—Ç–µ –Ω–æ–≤—ã–π commit

### –í–∞—Ä–∏–∞–Ω—Ç B: –ï—Å–ª–∏ –ª–æ–≥–æ–≤ –≤–æ–æ–±—â–µ –Ω–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω—ã–π
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Procfile –∏ start.sh
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PORT –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
4. Force redeploy

### –í–∞—Ä–∏–∞–Ω—Ç C: –ï—Å–ª–∏ scheduler loop –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ "[SCHEDULER] Loop alive!"
2. –ï—Å–ª–∏ –Ω–µ—Ç - –∑–Ω–∞—á–∏—Ç loop —É–ø–∞–ª
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ exception/traceback
4. –í–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç D: –ï—Å–ª–∏ scheduler loop –∏–¥–µ—Ç, –Ω–æ –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ searches –≤ –ë–î
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ "[SEARCH] Starting search cycle"
4. –ï—Å–ª–∏ –Ω–µ—Ç - –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º

---

## üéØ –°–ê–ú–ê–Ø –í–ï–†–û–Ø–¢–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:

**Railway –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Railway Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Deployments
3. –ù–∞–π–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π —É—Å–ø–µ—à–Ω—ã–π –¥–µ–ø–ª–æ–π
4. –ù–∞–∂–º–∏—Ç–µ "Redeploy"
5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 –º–∏–Ω—É—Ç—ã
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

---

## üìù –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢:

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏!

- [ ] –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω—ã–π (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)?
- [ ] Commit = `52abff1` –∏–ª–∏ –Ω–æ–≤–µ–µ?
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "[SCHEDULER] Entering main loop..."?
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "[HEALTH] Health check monitor started"?
- [ ] –ß–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –≤–∏–¥–Ω–æ "[SCHEDULER] Loop alive! Iteration 60"?
- [ ] DATABASE_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö?
- [ ] –¢–∞–±–ª–∏—Ü–∞ `searches` —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏?
- [ ] Gunicorn workers = 1?

–ï—Å–ª–∏ –≤—Å–µ ‚úÖ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

---

## üÜò –ï–°–õ–ò –ù–ò–ß–ï–ì–û –ù–ï –ü–û–ú–û–ì–õ–û:

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:
1. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ Railway
2. –°–∫—Ä–∏–Ω—à–æ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π!)
3. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–ª–∏—Ü—ã `searches` (–µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ?)

–Ø –Ω–∞–π–¥—É –ø—Ä–æ–±–ª–µ–º—É!

---

**–°–æ–∑–¥–∞–Ω–æ:** 2024-11-23
**–í–µ—Ä—Å–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** –ü–æ—Å–ª–µ —Ñ–∏–∫—Å–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (commits b145d39, 52abff1)
