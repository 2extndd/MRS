# üåê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–∫—Å–∏ - MercariSearcher

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 1. –ü–∞—Ä—Å–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –ø—Ä–æ–∫—Å–∏ (–ö–†–ò–¢–ò–ß–ù–û)

**–§–∞–π–ª:** `proxies.py`

**–§—É–Ω–∫—Ü–∏—è:** `parse_proxy_string(proxy_str: str) -> Optional[str]`

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
```python
# –í–∞—à —Ñ–æ—Ä–º–∞—Ç: ip:port:user:pass
"82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h" 
‚Üí "http://wtllhdak:9vxcxlvhxv1h@82.21.62.51:7815"

# –ë–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: ip:port
"192.168.1.1:8080" 
‚Üí "http://192.168.1.1:8080"

# –£–∂–µ –≥–æ—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (pass through)
"http://user:pass@10.0.0.1:3128" 
‚Üí "http://user:pass@10.0.0.1:3128"

# –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç None
"invalid" ‚Üí None
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –í—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã (—Å–º. `tmp_rovodev_test_proxy_parser.py`)

---

### ‚úÖ 2. –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ö–†–ò–¢–ò–ß–ù–û)

**–§–∞–π–ª:** `image_utils.py`

**–§—É–Ω–∫—Ü–∏—è:** `download_and_encode_image(image_url, timeout=10, use_proxy=True)`

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
```python
# BEFORE (–±–µ–∑ –ø—Ä–æ–∫—Å–∏)
response = requests.get(image_url, headers=headers, timeout=timeout)

# AFTER (—Å –ø—Ä–æ–∫—Å–∏ –∏ —Ä–æ—Ç–∞—Ü–∏–µ–π)
from proxies import proxy_rotator

proxies = None
if use_proxy and proxy_rotator:
    proxy_dict = proxy_rotator.get_proxy()
    if proxy_dict:
        proxies = proxy_dict
        logger.info(f"üì° Using proxy for image download")

response = requests.get(image_url, headers=headers, proxies=proxies, timeout=timeout)
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- **403 Forbidden** ‚Üí –ø–æ–º–µ—á–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –∫–∞–∫ failed, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π
- **Timeout** ‚Üí –ø–æ–º–µ—á–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –∫–∞–∫ failed
- **ProxyError** ‚Üí –ø–æ–º–µ—á–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –∫–∞–∫ failed

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
üì° Using proxy for image download: http://wtllhdak:9vxcxlvhxv1h@82.21.62...
‚úÖ Image encoded: 124.5KB ‚Üí 166.0KB base64
‚ö†Ô∏è  Proxy blocked (403), marking as failed: http://wtllhdak:9vxcx...
```

---

### ‚úÖ 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–í–ê–ñ–ù–û)

**–§–∞–π–ª:** `core.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

#### A. –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ª–æ–≥–æ–≤ —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
```python
[SCAN] üîç Scanning query: Nike Air Max
[SCAN] ‚úÖ Search completed: 15 total items from API, 3 NEW items added to DB
[PROCESS] üì¶ Processing 15 items from API response...
[PROCESS] ‚úÖ NEW item added to DB (ID: 142): Nike Air Max 90...
[PROCESS] ‚è≠Ô∏è  Item already exists in DB: m12345678
```

#### B. –°–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö items
```python
[SCAN] üÜï NEW ITEMS ADDED (3):
[SCAN]    1. Nike Air Max 90 White/Black - Size M - ¬•15,000
[SCAN]    2. Adidas Yeezy Boost 350 v2 - Size L - ¬•22,500
[SCAN]    3. Supreme Box Logo Hoodie Red - Size XL - ¬•35,000
```

#### C. –°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö items
```python
[SCAN] ‚ÑπÔ∏è  No new items (all 15 items already in database)
```

**–†–µ—à–µ–Ω–∏–µ "0 new items bug":**
- –õ–æ–≥–∏ —Ç–µ–ø–µ—Ä—å —á–µ—Ç–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: "X items from API, Y NEW items added to DB"
- –ï—Å–ª–∏ Y=0, —è–≤–Ω–æ –ø–∏—à–µ—Ç—Å—è "No new items (all already in database)"
- Existing items –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ DEBUG (–º–µ–Ω—å—à–µ —Å–ø–∞–º–∞)

---

### ‚úÖ 4. Web UI –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∫—Å–∏

**–§–∞–π–ª:** `web_ui_plugin/app.py`

**Endpoint:** `GET /api/proxy/stats`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "enabled": true,
  "stats": {
    "total_proxies": 120,
    "working_proxies": 98,
    "failed_proxies": 22,
    "last_validation": 1704123456.789,
    "current_proxy": "***@82.21.62.51:7815",
    "rotation_count": 45,
    "rotation_interval": 100
  }
}
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** Credentials –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω—ã (`***@ip:port`)

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–§–æ—Ä–º–∞—Ç:** `ip:port:user:pass` (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É –∏–ª–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

**–ß–µ—Ä–µ–∑ Web UI:**
1. –û—Ç–∫—Ä—ã—Ç—å `/config`
2. –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é "Proxy Configuration"
3. –í—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏:
```
82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h
82.21.62.52:7815:wtllhdak:9vxcxlvhxv1h
82.21.62.53:7815:wtllhdak:9vxcxlvhxv1h
...
```
4. –í–∫–ª—é—á–∏—Ç—å "Proxy Enabled": `true`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

**–ß–µ—Ä–µ–∑ environment variable:**
```bash
export PROXY_ENABLED=true
export PROXY_LIST="82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h,82.21.62.52:7815:wtllhdak:9vxcxlvhxv1h"
```

**–ß–µ—Ä–µ–∑ .env —Ñ–∞–π–ª:**
```env
PROXY_ENABLED=true
PROXY_LIST=82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h,82.21.62.52:7815:wtllhdak:9vxcxlvhxv1h
```

---

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

**–õ–æ–∫–∞–ª—å–Ω–æ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å worker
python3 mercari_notifications.py worker

# –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:
# ProxyManager initialized with 120 proxies (parsed from 120 entries, 0 invalid)
# Validating 120 proxies...
# Proxy validation complete: 98 working, 22 failed
# Proxy rotator initialized
```

**–ù–∞ Railway:**
1. Push –∏–∑–º–µ–Ω–µ–Ω–∏–π: `git push origin main`
2. Deploy worker: `railway up --service worker`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `railway logs --service worker`

---

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Web UI

**–û–ø—Ü–∏—è A: Dashboard (–±—É–¥—É—â–µ–µ)**
- –û—Ç–∫—Ä–æ–π—Ç–µ `/` (dashboard)
- –°–µ–∫—Ü–∏—è "Proxy Status" –ø–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–û–ø—Ü–∏—è B: API –Ω–∞–ø—Ä—è–º—É—é**
```bash
curl https://your-web-ui.railway.app/api/proxy/stats
```

**–û–ø—Ü–∏—è C: –¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏**
```bash
# –í Web UI –æ—Ç–∫—Ä–æ–π—Ç–µ /config
# –ù–∞–∂–º–∏—Ç–µ "Test Proxies"
# –£–≤–∏–¥–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–∫—Å–∏
```

---

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫—Å–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Configuration (env vars –∏–ª–∏ DB)
    ‚Üì
parse_proxy_string() - –ø–∞—Ä—Å–∏–Ω–≥ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    ‚Üì
ProxyManager - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    ‚îú‚îÄ‚îÄ validate_proxies() - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–∫—Å–∏ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
    ‚îú‚îÄ‚îÄ working_proxies[] - —Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–∫—Å–∏
    ‚îú‚îÄ‚îÄ failed_proxies[] - —Å–ø–∏—Å–æ–∫ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø—Ä–æ–∫—Å–∏
    ‚îî‚îÄ‚îÄ revalidate_failed_proxies() - –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–∞–∂–¥—ã–π —á–∞—Å)
    ‚Üì
ProxyRotator - —Ä–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏
    ‚îú‚îÄ‚îÄ current_proxy - —Ç–µ–∫—É—â–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–∫—Å–∏
    ‚îú‚îÄ‚îÄ request_count - —Å—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤
    ‚îú‚îÄ‚îÄ get_proxy() - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏ (—Ä–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤)
    ‚îî‚îÄ‚îÄ mark_current_failed() - –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ failed –ø—Ä–∏ –æ—à–∏–±–∫–µ
    ‚Üì
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    ‚îú‚îÄ‚îÄ core.py: MercariSearcher API requests
    ‚îú‚îÄ‚îÄ image_utils.py: Image downloads
    ‚îî‚îÄ‚îÄ mercari_scraper.py: HTML scraping (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
```

---

### –õ–æ–≥–∏–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏

**1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ):**
```
1. –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –ø—Ä–æ–∫—Å–∏ (ip:port:user:pass ‚Üí http://...)
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (10 workers, ThreadPoolExecutor)
3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ working_proxies
4. –í—ã–±–æ—Ä –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

**2. –í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
```
- –ö–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –ø—Ä–æ–∫—Å–∏
- –ü—Ä–∏ –æ—à–∏–±–∫–µ 403/429/timeout ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Å–º–µ–Ω–∞ –ø—Ä–æ–∫—Å–∏
- –ö–∞–∂–¥—ã–π —á–∞—Å ‚Üí —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏—è failed proxies
```

**3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
```python
if response.status_code == 403:
    proxy_rotator.mark_current_failed()  # –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ failed
    # –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏

if timeout_error:
    proxy_rotator.mark_current_failed()  # –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ failed
    # –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Å–µ—Ä–∞

```bash
python3 tmp_rovodev_test_proxy_parser.py

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# Testing proxy parser...
# ‚úÖ PASS - ip:port:user:pass format
# ‚úÖ PASS - ip:port format
# ‚úÖ PASS - http:// format
# Results: 6 passed, 0 failed
```

---

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Web UI

```bash
# 1. –û—Ç–∫—Ä—ã—Ç—å /config –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# 2. –í—Å—Ç–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏
# 3. –ù–∞–∂–∞—Ç—å "Test Proxies"
# 4. –£–≤–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

‚úÖ Proxy OK: ***@82.21.62.51:7815 (1234ms)
‚úÖ Proxy OK: ***@82.21.62.52:7815 (987ms)
‚ùå Proxy FAILED: ***@82.21.62.53:7815 - Timeout
...

üìä Proxy test completed: 98/120 working
```

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ª–æ–≥–∞—Ö

**–£—Å–ø–µ—à–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏:**
```
[SCAN] üîç Scanning query: Nike
üì° Using proxy for image download: http://wtllhdak:9vxcxlvhxv1h@82.21.62...
‚úÖ Image encoded: 124.5KB ‚Üí 166.0KB base64
[PROCESS] ‚úÖ NEW item added to DB (ID: 142): Nike Air Max 90...
```

**–°–º–µ–Ω–∞ –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```
Failed to download image: HTTP 403 (proxy: http://wtllhdak:9vxcxlvhxv1h@82.21.62...)
‚ö†Ô∏è  Proxy blocked (403), marking as failed: http://wtllhdak:9vxcxlvhxv1h@82.21.62...
üì° Using proxy for image download: http://wtllhdak:9vxcxlvhxv1h@82.21.62...  (–Ω–æ–≤—ã–π –ø—Ä–æ–∫—Å–∏!)
‚úÖ Image encoded: 124.5KB ‚Üí 166.0KB base64
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—Ç–∞—Ü–∏–∏

**–ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ä–æ—Ç–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 100 –∑–∞–ø—Ä–æ—Å–æ–≤):**

`proxies.py`, —Å—Ç—Ä–æ–∫–∞ 231:
```python
proxy_rotator = ProxyRotator(proxy_manager, rotation_count=50)  # –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 50 –∑–∞–ø—Ä–æ—Å–æ–≤
```

**–ò–∑–º–µ–Ω–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ä–µ–≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1 —á–∞—Å):**

`proxies.py`, —Å—Ç—Ä–æ–∫–∞ 79:
```python
self.validation_interval = 1800  # 30 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 3600 (1 —á–∞—Å)
```

---

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ workers –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10):**

`proxies.py`, —Å—Ç—Ä–æ–∫–∞ 77:
```python
def validate_proxies(self, max_workers: int = 20):  # 20 workers –≤–º–µ—Å—Ç–æ 10
```

**–í–ª–∏—è–Ω–∏–µ:**
- 10 workers: ~60 —Å–µ–∫—É–Ω–¥ –¥–ª—è 120 –ø—Ä–æ–∫—Å–∏
- 20 workers: ~30 —Å–µ–∫—É–Ω–¥ –¥–ª—è 120 –ø—Ä–æ–∫—Å–∏
- 50 workers: ~15 —Å–µ–∫—É–Ω–¥ –¥–ª—è 120 –ø—Ä–æ–∫—Å–∏ (–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å rate limit)

---

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏ (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞):**

```python
# –í configuration_values.py
PROXY_ENABLED = False

# –ò–ª–∏ —á–µ—Ä–µ–∑ environment variable
export PROXY_ENABLED=false
```

**–û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**

```python
# –í core.py, —Å—Ç—Ä–æ–∫–∞ 389
image_data = download_and_encode_image(image_url, use_proxy=False)
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**–ß–µ—Ä–µ–∑ `/api/proxy/stats`:**
- `total_proxies` - –≤—Å–µ–≥–æ –ø—Ä–æ–∫—Å–∏ –≤ —Å–ø–∏—Å–∫–µ
- `working_proxies` - —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø—Ä–æ–∫—Å–∏
- `failed_proxies` - –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø—Ä–æ–∫—Å–∏
- `current_proxy` - —Ç–µ–∫—É—â–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–∫—Å–∏
- `rotation_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —Ç–µ–∫—É—â–∏–º –ø—Ä–æ–∫—Å–∏
- `rotation_interval` - –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ä–æ—Ç–∞—Ü–∏–∏

### –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**Grep –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø—Ä–æ–±–ª–µ–º:**
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –æ—à–∏–±–∫–∏ –ø—Ä–æ–∫—Å–∏
railway logs --service worker | grep "Proxy blocked"
railway logs --service worker | grep "Proxy timeout"

# –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏
railway logs --service worker | grep "Using proxy" | wc -l

# –ù–∞–π—Ç–∏ —Å–º–µ–Ω—ã –ø—Ä–æ–∫—Å–∏
railway logs --service worker | grep "marking as failed"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å 120 –ø—Ä–æ–∫—Å–∏

–í–∞–ª–∏–¥–∞—Ü–∏—è 120 –ø—Ä–æ–∫—Å–∏ –∑–∞–π–º–µ—Ç **~60-90 —Å–µ–∫—É–Ω–¥** (10 workers):
```
ProxyManager initialized with 120 proxies
Validating 120 proxies...
[–ø–æ–¥–æ–∂–¥–∏—Ç–µ ~60 —Å–µ–∫—É–Ω–¥]
Proxy validation complete: 98 working, 22 failed
```

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

---

### 2. Cloudflare –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Railway IPs

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫—Å–∏ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** –Ω–∞ Railway –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
```
‚ùå –ë–ï–ó –ü–†–û–ö–°–ò: static.mercdn.net ‚Üí HTTP 403 (Cloudflare –±–ª–æ–∫–∏—Ä—É–µ—Ç Railway IP)
‚úÖ –° –ü–†–û–ö–°–ò: static.mercdn.net ‚Üí HTTP 200 (residential IP –æ–±—Ö–æ–¥–∏—Ç Cloudflare)
```

---

### 3. –†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏

**–ß–∞—Å—Ç–æ—Ç–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- API requests: –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ (~10-15 –º–∏–Ω—É—Ç –ø—Ä–∏ 300s –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ)
- Image downloads: –∫–∞–∂–¥—ã–µ 100 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (~15-20 –º–∏–Ω—É—Ç)
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

**–≠—Ç–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É:
- –ù–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ –ø—Ä–æ–∫—Å–∏ (–Ω–µ —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–∞—è —Ä–æ—Ç–∞—Ü–∏—è)
- –ò–∑–±–µ–∂–∞–Ω–∏–µ–º rate limits (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —á–∞—Å—Ç–∞—è —Ä–æ—Ç–∞—Ü–∏—è)

---

### 4. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å VintedSearcher

–ï—Å–ª–∏ –≤–∞—à–∏ –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ VintedSearcher, –æ–Ω–∏ **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ** –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∑–¥–µ—Å—å:
- –¢–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç: `ip:port:user:pass`
- –¢–æ—Ç –∂–µ –ø–∞—Ä—Å–µ—Ä: `parse_proxy_string()`
- –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "No working proxies available"

**–ü—Ä–∏—á–∏–Ω–∞:** –í—Å–µ –ø—Ä–æ–∫—Å–∏ failed –≤–∞–ª–∏–¥–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø—Ä–æ–∫—Å–∏ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `ip:port:user:pass`)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials (user:pass –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ?)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∫—Å–∏ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Web UI

---

### –ü—Ä–æ–±–ª–µ–º–∞: "Invalid proxy format"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–∫—Å–∏ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
82.21.62.51:7815/wtllhdak/9vxcxlvhxv1h  (—Å–ª—ç—à–∏ –≤–º–µ—Å—Ç–æ –¥–≤–æ–µ—Ç–æ—á–∏–π)
http://82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h  (http:// –≤ –Ω–∞—á–∞–ª–µ, –Ω–æ credentials —á–µ—Ä–µ–∑ :)
```

---

### –ü—Ä–æ–±–ª–µ–º–∞: Images –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (403)

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Cloudflare

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `grep "Proxy blocked" logs`
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–º–µ–Ω–∏—Ç –ø—Ä–æ–∫—Å–∏
3. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–∫—Å–∏ blocked ‚Üí –∫—É–ø–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–æ–∫—Å–∏

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–∫—Å–∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏–ª–∏ –¥–∞–ª–µ–∫–æ –æ—Ç Japan

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –±–ª–∏–∂–µ –∫ Japan (Korea, Hong Kong, Singapore)
2. –£–≤–µ–ª–∏—á–∏—Ç—å timeout: `download_and_encode_image(url, timeout=20)`
3. –£–º–µ–Ω—å—à–∏—Ç—å rotation_count –¥–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç–æ–π —Å–º–µ–Ω—ã –ø—Ä–æ–∫—Å–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

**–§–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:**
- `proxies.py` - –≤—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–∫—Å–∏
- `image_utils.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `core.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏ –¥–ª—è API
- `tmp_rovodev_test_proxy_parser.py` - —Ç–µ—Å—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞
- `tmp_rovodev_TODO_PROXY_AND_LOGGING.md` - –ø–æ–ª–Ω—ã–π TODO –ª–∏—Å—Ç
- `tmp_rovodev_ANALYSIS_SUMMARY.md` - –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã

**Web UI endpoints:**
- `/api/proxy/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∫—Å–∏
- `/api/proxy/test` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏
- `/api/config/proxy` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–∫—Å–∏

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –¥–µ–ø–ª–æ—é

- [x] –ü–∞—Ä—Å–µ—Ä –ø—Ä–æ–∫—Å–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] –ü—Ä–æ–∫—Å–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É–ª—É—á—à–µ–Ω–æ –∏ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- [x] Web UI endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü—Ä–æ–∫—Å–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ Railway –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] –õ–æ–≥–∏ –Ω–∞ Railway –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

---

**–ê–≤—Ç–æ—Ä:** Rovo Dev AI Agent  
**–î–∞—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
