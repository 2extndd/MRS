# üèóÔ∏è MercariSearcher - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ–∫—Å–∏

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ç–µ–∫—É—â–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
3. [–¶–∏–∫–ª –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ–π](#—Ü–∏–∫–ª-–ø–æ–∏—Å–∫–∞-–≤–µ—â–µ–π)
4. [–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫—Å–∏ –∏ —Ä–æ—Ç–∞—Ü–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–ø—Ä–æ–∫—Å–∏-–∏-—Ä–æ—Ç–∞—Ü–∏—è)
5. [–ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫](#–∑–∞—â–∏—Ç–∞-–æ—Ç-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫)
6. [–ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ](#—á—Ç–æ-–Ω–µ-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
7. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Railway Cloud  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ Web UI    ‚îÇ‚óÑ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ User Browser ‚îÇ
‚îÇ  ‚îÇ (Flask)   ‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ        ‚ñ≤        ‚îÇ
‚îÇ        ‚îÇ (DB)   ‚îÇ
‚îÇ        ‚ñº        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇPostgreSQL ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ        ‚ñ≤        ‚îÇ
‚îÇ        ‚îÇ        ‚îÇ
‚îÇ        ‚ñº        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ Worker    ‚îÇ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Mercari API  ‚îÇ
‚îÇ  ‚îÇ(Scanner)  ‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ             ‚îÇ
‚îÇ        ‚îÇ        ‚îÇ             ‚îÇ (images)
‚îÇ        ‚ñº        ‚îÇ             ‚ñº
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚îÇ Telegram  ‚îÇ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ User Chat    ‚îÇ
‚îÇ  ‚îÇ  Sender   ‚îÇ  ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îÇ (via proxy)
        ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ 115 Proxies  ‚îÇ
  ‚îÇ (residential)‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ (–û–î–ò–ù –†–ê–ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Worker)**

**–§–∞–π–ª:** [proxies.py:283-293](proxies.py#L283-L293)

```python
# Initialize global proxy manager
proxy_manager = None
proxy_rotator = None

if config.PROXY_ENABLED and config.PROXY_LIST:
    logger.info("Initializing proxy system...")
    proxy_manager = ProxyManager(config.PROXY_LIST)  # ‚Üê –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è 1 —Ä–∞–∑!

    if proxy_manager.working_proxies:
        proxy_rotator = ProxyRotator(proxy_manager)
        logger.info("Proxy rotator initialized")
```

**‚ùó –ü–†–û–ë–õ–ï–ú–ê:**
- –ü—Ä–æ–∫—Å–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **1 —Ä–∞–∑** –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
- **–ù–ï–¢ –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ config.PROXY_ENABLED –≤ –ë–î –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Worker
- **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç** - –ø—Ä–æ–∫—Å–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –≤—Å—ë

### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ (–ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)**

**–§–∞–π–ª:** [proxies.py:88-125](proxies.py#L88-L125)

```python
def validate_proxies(self, max_workers: int = 10):
    """Validate all proxies in parallel"""

    with ThreadPoolExecutor(max_workers=max_workers) as executor:
        future_to_proxy = {
            executor.submit(self._test_proxy, proxy): proxy
            for proxy in self.all_proxies
        }

        for future in as_completed(future_to_proxy):
            proxy = future_to_proxy[future]
            is_working = future.result()
            if is_working:
                working.append(proxy)
            else:
                failed.append(proxy)
```

**–¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Mercari.jp —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ (HTTP 200 = —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 3. **–†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ (–∫–∞–∂–¥—ã–µ N –∑–∞–ø—Ä–æ—Å–æ–≤)**

**–§–∞–π–ª:** [proxies.py:250-269](proxies.py#L250-L269)

```python
def get_proxy(self) -> Optional[Dict]:
    """Get current proxy for requests"""

    # Rotate if needed
    if self.request_count >= self.rotation_count:  # rotation_count = 100
        self.current_proxy = self.proxy_manager.get_proxy()
        self.request_count = 0

    self.request_count += 1

    return {
        'http': self.current_proxy,
        'https': self.current_proxy
    }
```

**–†–æ—Ç–∞—Ü–∏—è:**
- –ü—Ä–æ–∫—Å–∏ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ **100 –∑–∞–ø—Ä–æ—Å–æ–≤** (–Ω–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç!)
- –†–æ—Ç–∞—Ü–∏—è = "round-robin" (–ø–µ—Ä–≤—ã–π –ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞)

### 4. **User-Agent (–°–¢–ê–¢–ò–ß–ï–°–ö–ò–ô)**

**–§–∞–π–ª:** [image_utils.py:36](image_utils.py#L36)

```python
headers = {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    # ... –¥—Ä—É–≥–∏–µ headers
}
```

**‚ùó –ü–†–û–ë–õ–ï–ú–ê:**
- **–û–î–ò–ù –ò –¢–û–¢ –ñ–ï** User-Agent –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ù–ï–¢ —Ä–æ—Ç–∞—Ü–∏–∏ UA** –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∏–ª–∏ –≤–æ–æ–±—â–µ
- **–ù–ï–¢ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Å—Å–∏–π** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## –¶–∏–∫–ª –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ–π

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥):

```
1. Timer —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)
   ‚îî‚îÄ> mercari_notifications.py:run_worker()

2. –ó–∞–≥—Ä—É–∑–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤ –∏–∑ –ë–î
   ‚îî‚îÄ> db.get_active_searches()
   ‚îî‚îÄ> –†–µ–∑—É–ª—å—Ç–∞—Ç: [Search(id=1, query="archive"), Search(id=2, query="y2k")]

3. –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ü–û–ò–°–ö–ê:
   ‚îú‚îÄ> mercapi.search(query, limit=120)
   ‚îÇ   ‚îî‚îÄ> Request –∫ Mercari API
   ‚îÇ   ‚îî‚îÄ> –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∫—Å–∏ (mercapi –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
   ‚îÇ   ‚îî‚îÄ> –†–µ–∑—É–ª—å—Ç–∞—Ç: [{item}, {item}, ...]
   ‚îÇ
   ‚îú‚îÄ> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö items (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î)
   ‚îÇ   ‚îî‚îÄ> db.execute_query("SELECT mercari_id FROM items WHERE mercari_id = %s")
   ‚îÇ   ‚îî‚îÄ> –ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí —ç—Ç–æ –Ω–æ–≤—ã–π item
   ‚îÇ
   ‚îú‚îÄ> –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ù–û–í–û–ì–û ITEM:
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ> –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> image_utils.download_and_encode_image(image_url, use_proxy=True)
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> proxy_rotator.get_proxy()  ‚Üê –ë–µ—Ä–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–∫—Å–∏
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> requests.get(image_url, proxies=proxy_dict)
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> –ï—Å–ª–∏ HTTP 403 ‚Üí proxy_rotator.mark_current_failed()
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> –†–µ–∑—É–ª—å—Ç–∞—Ç: base64 data URI –∏–ª–∏ None
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îú‚îÄ> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
   ‚îÇ   ‚îÇ   ‚îî‚îÄ> db.add_item(
   ‚îÇ   ‚îÇ       mercari_id=item_id,
   ‚îÇ   ‚îÇ       title=title,
   ‚îÇ   ‚îÇ       price=price,
   ‚îÇ   ‚îÇ       image_url=image_url,
   ‚îÇ   ‚îÇ       image_data=base64_data,  ‚Üê –ú–æ–∂–µ—Ç –±—ã—Ç—å None –µ—Å–ª–∏ –ø—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
   ‚îÇ   ‚îÇ       is_sent=False
   ‚îÇ   ‚îÇ   )
   ‚îÇ   ‚îÇ
   ‚îÇ   ‚îî‚îÄ> –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
   ‚îÇ       ‚îî‚îÄ> telegram_sender.send_notification(item)
   ‚îÇ       ‚îî‚îÄ> –ï—Å–ª–∏ image_data –µ—Å—Ç—å ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
   ‚îÇ       ‚îî‚îÄ> –ï—Å–ª–∏ image_data = None ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
   ‚îÇ
   ‚îî‚îÄ> –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–∏—Å–∫—É

4. –ñ–¥–µ—Ç 60 —Å–µ–∫—É–Ω–¥
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å —à–∞–≥–∞ 1
```

### –ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

```
Time    | Action                    | Proxy Used
--------|---------------------------|---------------------------
00:00   | Search "archive"          | (no proxy, direct to API)
00:01   | Download image 1          | http://proxy1:port
00:02   | Download image 2          | http://proxy1:port (count=2)
00:03   | Download image 3          | http://proxy1:port (count=3)
...     | ...                       | ...
00:50   | Download image 99         | http://proxy1:port (count=99)
00:51   | Download image 100        | http://proxy1:port (count=100)
00:52   | Download image 101        | http://proxy2:port (count=1) ‚Üê ROTATED!
01:00   | Search "y2k"              | (no proxy)
01:01   | Download image 102        | http://proxy2:port (count=2)
```

**–†–æ—Ç–∞—Ü–∏—è:** –ü–æ—Å–ª–µ 100 —Å–∫–∞—á–∏–≤–∞–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–æ–∫—Å–∏ –º–µ–Ω—è–µ—Ç—Å—è

---

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–∫—Å–∏ –∏ —Ä–æ—Ç–∞—Ü–∏—è

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

#### ‚úÖ –ß—Ç–æ –†–ê–ë–û–¢–ê–ï–¢:

1. **–ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–∫—Å–∏ —Ñ–æ—Ä–º–∞—Ç–∞ `ip:port:user:pass`**
   ```python
   # proxies.py:16-53
   parse_proxy_string("82.21.62.51:7815:wtllhdak:9vxcxlvhxv1h")
   # ‚Üí "http://wtllhdak:9vxcxlvhxv1h@82.21.62.51:7815"
   ```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏** (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, 10 –ø–æ—Ç–æ–∫–æ–≤)
   - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –ø—Ä–æ–∫—Å–∏ –∑–∞–ø—Ä–æ—Å–æ–º –∫ Mercari.jp
   - –†–∞–∑–¥–µ–ª—è–µ—Ç –Ω–∞ working/failed
   - –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

3. **–†–æ—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏**
   - Round-robin: –ø–µ—Ä–≤—ã–π –ø—Ä–æ–∫—Å–∏ ‚Üí –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞
   - –¢—Ä–∏–≥–≥–µ—Ä: –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø—Ä–æ–∫—Å–∏**
   - –ü—Ä–∏ HTTP 403 ‚Üí mark_proxy_failed()
   - –ü—Ä–∏ timeout ‚Üí mark_proxy_failed()
   - –ü—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ failed —Å–ø–∏—Å–æ–∫

5. **–†–µvalid–∞—Ü–∏—è failed –ø—Ä–æ–∫—Å–∏**
   - –ö–∞–∂–¥—ã–π —á–∞—Å (validation_interval = 3600)
   - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ failed –ø—Ä–æ–∫—Å–∏
   - –ï—Å–ª–∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–∏ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ working

#### ‚ùå –ß—Ç–æ –ù–ï –†–ê–ë–û–¢–ê–ï–¢ / –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û:

1. **–ì–æ—Ä—è—á–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∫—Å–∏**
   - ‚ùå config.PROXY_ENABLED –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
   - ‚ùå config.PROXY_LIST –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
   - **–ü–æ—á–µ–º—É:** –ü—Ä–æ–∫—Å–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è (—Å—Ç—Ä–æ–∫–∞ 283)

2. **–†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç**
   - ‚ùå –ü—Ä–æ–∫—Å–∏ –ù–ï –º–µ–Ω—è—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
   - ‚ùå –ú–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ N –∑–∞–ø—Ä–æ—Å–æ–≤
   - **–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:** rotation_count = 100 –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–†–∞–∑–Ω—ã–µ User-Agent –¥–ª—è —Å–µ—Å—Å–∏–π**
   - ‚ùå –û–î–ò–ù User-Agent –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - ‚ùå –ù–ï–¢ —Ä–æ—Ç–∞—Ü–∏–∏ UA
   - ‚ùå –ù–ï–¢ —Ä–∞–∑–Ω—ã—Ö UA –¥–ª—è —Ä–∞–∑–Ω—ã—Ö search queries

4. **–†–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–∫—Å–∏**
   - ‚ùå –¢–æ–ª—å–∫–æ –û–î–ò–ù worker process
   - ‚ùå –ù–ï–¢ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏ –ø–æ search queries
   - ‚ùå –ù–ï–¢ –∏–∑–æ–ª—è—Ü–∏–∏ —Å–µ—Å—Å–∏–π

---

## –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### –¢–µ–∫—É—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã:

#### 1. **–ü—Ä–æ–∫—Å–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
- ‚úÖ Residential proxies (115 —à—Ç—É–∫)
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –ø—Ä–æ–∫—Å–∏
- ‚ùå –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ rate limit

#### 2. **Headers –¥–ª—è –æ–±—Ö–æ–¥–∞ Cloudflare**
```python
headers = {
    'User-Agent': 'Mozilla/5.0 ...',  # Browser UA
    'Referer': 'https://jp.mercari.com/',  # Pretend coming from Mercari
    'Accept': 'image/avif,image/webp,...',  # Accept modern formats
    'Accept-Language': 'ja-JP,ja;q=0.9',  # Japanese locale
    'Cache-Control': 'no-cache',
    'Pragma': 'no-cache'
}
```

#### 3. **–ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏**
- ‚úÖ Global delay: 60 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
- ‚úÖ Per-search delay: SEARCH_INTERVAL (60 —Å–µ–∫)
- ‚ùå –ù–ï–¢ —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ (random jitter)

#### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ HTTP 403 ‚Üí mark proxy as failed
- ‚úÖ Timeout ‚Üí mark proxy as failed
- ‚úÖ Retry failed proxies —á–µ—Ä–µ–∑ 1 —á–∞—Å
- ‚ùå –ù–ï–¢ exponential backoff

### –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞:

1. **Mercari API –∑–∞–ø—Ä–æ—Å—ã –ë–ï–ó –ø—Ä–æ–∫—Å–∏**
   ```python
   # mercapi library –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç proxies parameter
   results = mercapi.search(query)  # ‚Üê Direct connection, no proxy!
   ```
   **–†–∏—Å–∫:** Railway IP –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω Mercari API

2. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π User-Agent**
   - –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ UA –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∫–∞–∫ –±–æ—Ç–∞

3. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —Ä–æ—Ç–∞—Ü–∏—è**
   - –í—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ù–µ—Ç —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–∏

---

## –ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –ò–∑ —Ç–≤–æ–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:

> "—Å–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ —Ä–∞–∑–Ω—ã–µ user agent —Å–µ—Å—Å–∏–∏ –∏ —Ä–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ø—Ä–æ–∫—Å–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∫–∞–∫ —è –∫–æ–≥–¥–∞-—Ç–æ –ø—Ä–æ—Å–∏–ª??"

#### ‚ùå –ù–ï–¢ —Ä–∞–∑–Ω—ã—Ö User-Agent —Å–µ—Å—Å–∏–π

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –û–î–ò–ù User-Agent –¥–ª—è –í–°–ï–• –∑–∞–ø—Ä–æ—Å–æ–≤
headers = {'User-Agent': 'Mozilla/5.0 (Macintosh; ...)'}
```

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. –°–ø–∏—Å–æ–∫ —Ä–∞–∑–Ω—ã—Ö User-Agent —Å—Ç—Ä–æ–∫
2. –†–∞–Ω–¥–æ–º–Ω—ã–π –≤—ã–±–æ—Ä UA –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏–ª–∏ –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏
3. –ü—Ä–∏–≤—è–∑–∫–∞ UA –∫ –ø—Ä–æ–∫—Å–∏ (–æ–¥–∏–Ω –ø—Ä–æ–∫—Å–∏ = –æ–¥–∏–Ω UA)

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```python
USER_AGENTS = [
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...',
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) ...',
    'Mozilla/5.0 (X11; Linux x86_64) ...',
    # ... –µ—â–µ 20-50 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
]

def get_random_user_agent():
    import random
    return random.choice(USER_AGENTS)

# –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ:
headers = {'User-Agent': get_random_user_agent()}
```

#### ‚ùå –ù–ï–¢ —Ä–∞–∑–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –û–¥–∏–Ω worker process
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –í–°–ï search queries –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ worker –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –ö–∞–∂–¥—ã–π worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–≤–æ—é –≥—Ä—É–ø–ø—É searches
- –ö–∞–∂–¥—ã–π worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π –ø—É–ª –ø—Ä–æ–∫—Å–∏

**–≠—Ç–æ —Å–ª–æ–∂–Ω–æ –Ω–∞ Railway** –ø–æ—Ç–æ–º—É —á—Ç–æ:
- Railway –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1 Worker service
- –ù—É–∂–Ω–æ –±—ã–ª–æ –±—ã —Å–æ–∑–¥–∞—Ç—å Worker-1, Worker-2, Worker-3...
- –î–æ—Ä–æ–≥–æ ($5/–º–µ—Å—è—Ü –∑–∞ –∫–∞–∂–¥—ã–π service)

#### ‚ùå –ù–ï–¢ —Ä–æ—Ç–∞—Ü–∏–∏ –ø—Ä–æ–∫—Å–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–ï–¢ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞

**–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```python
import time

class ProxyRotator:
    def __init__(self, proxy_manager, rotation_interval=300):  # 300 —Å–µ–∫ = 5 –º–∏–Ω—É—Ç
        self.rotation_interval = rotation_interval
        self.last_rotation_time = time.time()

    def get_proxy(self):
        # Check if 5 minutes passed
        if time.time() - self.last_rotation_time > self.rotation_interval:
            self.current_proxy = self.proxy_manager.get_proxy()
            self.last_rotation_time = time.time()
            logger.info(f"‚è∞ Proxy rotated after {self.rotation_interval}s")

        return self.current_proxy
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ —Ç–æ—á–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

#### 1. **–í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –ë–î —á–µ—Ä–µ–∑ Web UI**
```sql
-- –£–∂–µ —Å–¥–µ–ª–∞–Ω–æ:
UPDATE key_value_store SET value = 'true' WHERE key = 'config_proxy_enabled';
```

**–ù–æ Worker –ù–ï –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!**

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Worker service –Ω–∞ Railway:
```bash
railway up -s Worker --detach
```

#### 2. **–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä—è—á—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ–∫—Å–∏**

**–§–∞–π–ª:** `proxies.py`
```python
import time

# Global state
_last_config_check = 0
_config_check_interval = 10  # Check every 10 seconds

def reload_proxy_config_if_needed():
    """Check database for config changes and reload if needed"""
    global proxy_manager, proxy_rotator, _last_config_check

    if time.time() - _last_config_check < _config_check_interval:
        return  # Too soon, skip

    _last_config_check = time.time()

    # Load config from database
    from db import DatabaseManager
    db = DatabaseManager()
    proxy_enabled = db.load_config('config_proxy_enabled', 'false') == 'true'
    proxy_list = db.load_config('config_proxy_list', '')
    db.close()

    # Check if config changed
    current_enabled = (proxy_manager is not None)

    if proxy_enabled != current_enabled:
        logger.info(f"üîÑ Proxy config changed: {current_enabled} ‚Üí {proxy_enabled}")

        if proxy_enabled and proxy_list:
            # Initialize proxy system
            proxy_manager = ProxyManager(proxy_list.split('\n'))
            if proxy_manager.working_proxies:
                proxy_rotator = ProxyRotator(proxy_manager)
                logger.info("‚úÖ Proxy system initialized from DB")
        else:
            # Disable proxy system
            proxy_manager = None
            proxy_rotator = None
            logger.info("‚è∏Ô∏è  Proxy system disabled")

# Call this in image_utils.download_and_encode_image() before using proxy
reload_proxy_config_if_needed()
```

#### 3. **–î–æ–±–∞–≤–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é User-Agent**

**–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:** `user_agents.py`
```python
import random

USER_AGENTS = [
    # Windows Chrome
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36',

    # Mac Chrome
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36',

    # Mac Safari
    'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15',

    # Windows Edge
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0',

    # Linux Firefox
    'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/120.0',
]

def get_random_user_agent():
    """Get random User-Agent string"""
    return random.choice(USER_AGENTS)
```

**–û–±–Ω–æ–≤–∏—Ç—å:** `image_utils.py:36`
```python
from user_agents import get_random_user_agent

headers = {
    'User-Agent': get_random_user_agent(),  # ‚Üê Random!
    'Referer': 'https://jp.mercari.com/',
    # ...
}
```

### –ß—Ç–æ –º–æ–∂–Ω–æ –Ω–µ –¥–µ–ª–∞—Ç—å (—Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ):

- ‚ùå –†–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã - –¥–æ—Ä–æ–≥–æ –Ω–∞ Railway
- ‚ùå –†–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç - —Ç–µ–∫—É—â–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ
- ‚ùå –ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Å—Å–∏–π per-search - –Ω–µ –Ω—É–∂–Ω–æ, –æ–¥–∏–Ω worker —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

---

## –ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã

### 1. "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–Ω–æ–ø–∫–∞ Test Proxies?"

**–§–∞–π–ª:** [web_ui_plugin/app.py:726-780](web_ui_plugin/app.py#L726-L780)

```python
@app.route('/api/proxy/test', methods=['POST'])
def api_test_proxies():
    # 1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç proxy_list –∏–∑ config
    # 2. –ü–∞—Ä—Å–∏—Ç –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ parse_proxy_string()
    # 3. –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –ø—Ä–æ–∫—Å–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (10 –ø–æ—Ç–æ–∫–æ–≤)
    # 4. –ó–∞–ø—Ä–æ—Å –∫ httpbin.org/ip —á–µ—Ä–µ–∑ –∫–∞–∂–¥—ã–π –ø—Ä–æ–∫—Å–∏
    # 5. –ï—Å–ª–∏ HTTP 200 ‚Üí working, –∏–Ω–∞—á–µ failed
    # 6. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {working: X, total: Y, message: "..."}
```

**–û—Ç–≤–µ—Ç:** ‚úÖ –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ø—Ä–æ–∫—Å–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ

### 2. "–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏ –Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å?"

**–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:** [proxies.py:88-125](proxies.py#L88-L125)
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–º –∫ Mercari.jp
- HTTP 200 = working, –¥—Ä—É–≥–æ–µ = failed

**–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏:** [image_utils.py:58-66](image_utils.py#L58-L66)
- HTTP 403 ‚Üí mark_proxy_failed()
- Timeout ‚Üí mark_proxy_failed()
- Failed –ø—Ä–æ–∫—Å–∏ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ —Ä–æ—Ç–∞—Ü–∏–∏
- –†–µvalid–∞—Ü–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å

**–û—Ç–≤–µ—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø—Ä–æ–∫—Å–∏

### 3. "–°–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ —Ä–∞–∑–Ω—ã–µ user agent —Å–µ—Å—Å–∏–∏?"

**–û—Ç–≤–µ—Ç:** ‚ùå –ù–ï–¢, –æ–¥–∏–Ω User-Agent –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 4. "–†–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –ø—Ä–æ–∫—Å–∏?"

**–û—Ç–≤–µ—Ç:** ‚ùå –ù–ï–¢, –æ–¥–∏–Ω worker, —Ä–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)

### 5. "–†–∞—Å—Å–∫–∞–∂–∏ –≤–µ—Å—å —Ü–∏–∫–ª –ø–æ–∏—Å–∫–∞"

**–û—Ç–≤–µ—Ç:** –°–º. —Ä–∞–∑–¥–µ–ª ["–¶–∏–∫–ª –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ–π"](#—Ü–∏–∫–ª-–ø–æ–∏—Å–∫–∞-–≤–µ—â–µ–π) –≤—ã—à–µ

### 6. "–ü—Ä–æ–∫—Å–∏ –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–µ–≤–µ—Ä–Ω–æ –≤ web ui"

**–û—Ç–≤–µ—Ç:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (commit 094d3dd), –Ω—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å: `railway up -s web --detach`

### 7. "–ù–ï–¢ –§–û–¢–û–ì–†–ê–§–ò–ô –ù–ê –í–ï–©–ê–•!!!"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. ‚ùå –ü—Ä–æ–∫—Å–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã (`config_proxy_enabled = false`)
2. ‚ùå Worker –ù–ï –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª –∫–æ–Ω—Ñ–∏–≥ –ø–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–∫—Å–∏ –≤ –ë–î
3. ‚ùå –í—Å–µ –ø—Ä–æ–∫—Å–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã/–º–µ—Ä—Ç–≤—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# 1. –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –ë–î (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Worker
railway up -s Worker --detach

# 3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã
# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
railway logs -s Worker | grep -i proxy

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# "Initializing proxy system..."
# "ProxyManager initialized with 115 proxies"
# "Validating 115 proxies..."
# "Proxy validation complete: XX working, YY failed"
```

---

**–î–∞—Ç–∞:** 2025-11-19
**–í–µ—Ä—Å–∏—è:** Session 5.6
**–°—Ç–∞—Ç—É—Å:** Documented, proxies configured but not reloaded by Worker
